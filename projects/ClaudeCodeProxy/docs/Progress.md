# Progress Log

Keeps a running summary of major milestones by date. Mirrors the structure used in `~/git/tools/agentos/docs/SessionReports/` (see there for inspiration when expanding this file).

| Date (UTC) | Highlights |
|------------|------------|
| 2025-11-02 | - Sanity gating wired into `ccc-on/ccc-restart`: waits for `/healthz` before declaring ON; on failure, exits non‑zero and tails `logs/prod/ccp.out` (80 lines).<br>- `cz-up` finalized as the one‑liner: starts if needed, health‑gates 5s, sets env, then launches Claude in the current directory; supports `cz-up 8182`.<br>- Autostart hardened: added `scripts/launch/start-on-login.sh` and updated LaunchAgent to wait up to 10s for health and log failures to `logs/prod/launchctl.err` with a `ccp.out` tail.<br>- SOPs updated: CLI startup/autostart doc reflects gating; added a `CAPTURE-HELPER.md` with rid/partials triage steps. |
| 2025-10-26 | - FW0–FW3 local routing QA executed on master: tests green (FW0), community Anth pass-through proven (FW1), licensed Haiku→Z.ai proven (FW2, header_mode:"authorization"), mixed run shows back-to-back Anth 200 and Z.ai 200 (FW3).<br>- Added docs/Tasks/LOCAL_ROUTING_QA.md consolidating the exact commands and acceptances (non-interactive and interactive).<br>- Confirmed interactive stability with Accept-Encoding normalization on Z.ai lane; no gzip parse errors seen in -p flows; interactive guidance added to SOP. |
| 2025-10-26 | - Reproduced Z.ai routing success on pre-license commit `dc3791e` via `scripts/repro-go-shim-quick.sh` (Haiku 200s captured in `logs/usage_go_repro_quick.jsonl`).<br>- Confirmed regression introduced at `44025be` (license gate rejecting Z.ai without pack).<br>- Restored licensed flow on `master`: scripted issuer now exports `CCP_LICENSE_PUBKEY_B64` with guest kid, shim accepts env-supplied keys, Haiku probe returns 200 with `header_mode:"authorization"`.<br>- Added `scripts/uat/run_haiku_zai.sh`, `scripts/uat/run_sonnet_anth.sh`, and `scripts/uat/run_haiku_sonnet.sh` to prove Z.ai and Anth lanes via `claude -p` (each prints the CLI JSON and corresponding `lane` log lines). |
| 2025-10-22 | - License UX device flow finished (`cc license login`, loopback option).<br>- Shellcheck added to toolchain and scripts linted.<br>- Dual profile scaffolding (prod/dev) established with wrappers + SOPs.<br>- Zero-touch proxy toggle shipped (`ccc-on/off/status/logs`, installer writes `~/.config/ccc/env`); manual `ccp-*` kept as fallback.<br>- Smoke tests executed with mock issuer; artifacts under profile dirs.<br>- System/SOP doc structure scaffolded for future imports (CE Magic prompts copied, integration draft).<br>- Thinking sanitizer plan authored (`docs/Tasks/mitm_strip_thinking.*`). |
| 2025-10-23 | - Hardened shim upstream selection (ignores client `ANTHROPIC_BASE_URL`; new `CCP_UPSTREAM_*` envs with logging).<br>- Relocated policy cache under `CCP_LOGS_DIR` and bundled automatically.<br>- Expanded hygiene tests (auth/x-api-key stripping, SSE with env overrides) and added SSE chunk instrumentation.<br>- Local license issuer gained request caps + rate limiting.<br>- Private packaging scaffolding landed (`scripts/release/build-artifacts.sh`, brew/winget templates, stealth-only docs) plus signing checklist/scripts.<br>- Rotation knobs exposed via `CCP_LOG_MAX_BYTES`/`CCP_LOG_MAX_FILES`; summarizer reports per-lane SSE stats; `scripts/prune-results.sh` keeps metrics tidy.<br>- Docs updated to make `ccc-on` the primary flow; troubleshooting covers new env overrides. |
| 2025-10-23 | - Hardened shim upstream selection (ignores client `ANTHROPIC_BASE_URL`; new `CCP_UPSTREAM_*` envs with logging).<br>- Relocated policy cache under `CCP_LOGS_DIR` and bundled automatically.<br>- Expanded hygiene tests (auth/x-api-key stripping, SSE with env overrides) and added SSE chunk instrumentation.<br>- Local license issuer gained request caps + rate limiting.<br>- Private packaging scaffolding landed (`scripts/release/build-artifacts.sh`, brew/winget templates, stealth-only docs) plus signing checklist/scripts.<br>- Rotation knobs exposed via `CCP_LOG_MAX_BYTES`/`CCP_LOG_MAX_FILES`; summarizer reports per-lane SSE stats; `scripts/prune-results.sh` keeps metrics tidy.<br>- Docs updated to make `ccc-on` the primary flow; troubleshooting covers new env overrides.<br>- R2 finalize: quotas weekly window correctness (tokens/hours) + rolling ETA; streaming partials metric + dumps; `cc quotas reload` helper; tests added; docs/hand-off updated. |
| 2025-10-23 | - R2.5: budget guard enforcement (decision:"quota_block") routed Z.AI → Anth when >=100% on model; tests green.<br>- Docs: OPS adds `/readyz` 200–405 rationale + `reason`; handoff polished; planning docs imported (ADR/PRD/R2/R3).<br>- Repo hygiene: stopped tracking `.DS_Store`; cleaned tree; personal tmp split artifacts archived under `~/git/personal/archive/` (deduped vs repo). |
| 2025-10-23 | - R3 kickoff: added streaming & dirty TPS metrics per model (rolling/session + 24 h trend).<br>- `/v1/usage` now returns `speeds`; `cc status` renders a table with TPS + fastest hour; `--json` exposes raw payload.<br>- Metrics export token/duration counters; docs (QUOTAS/OPS/Handoff) updated to call hours telemetry-only. |
| 2025-10-23 | - Licensing track: added Apache-2.0 `LICENSE`, `NOTICE`, and third-party notices; `make check-licenses` verifies coverage.<br>- Provider catalog: schema accepts `header_mode`/`scoped_env`; `cc providers` prints formatted table with routes. |

Update this table at the end of each session with key changes, then copy detailed command/validation notes into `docs/SESSION_HANDOFF.md`.
