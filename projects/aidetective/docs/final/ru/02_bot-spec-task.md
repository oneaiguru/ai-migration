# Telegram Detective Bot — Требования к спецификации документа

## Обзор проекта

Создайте всеобъемлющий технический документ для интерактивного детективного бота в Telegram под названием «Шерлок ИИ». Этот бот позволяет пользователям участвовать в расследованиях, принимать решения, влияющие на сюжет, и раскрывать преступления с помощью ответов, сгенерированных ИИ.

## Основные характеристики для определения

### Принципы дизайна

- Дизайн взаимодействия, ориентированный на пользователя
- Иммерсивный опыт повествования
- Реалистичная симуляция детектива
- Бесшовная интеграция мультимедиа
- Интуитивно понятные принципы UI/UX
- Отзывчивость команд
- Чёткие индикаторы прогресса
- Задействующая механика вознаграждений

### 1. Базовый функционал бота и техническая архитектура

- **Детали реализации команд:**
  * `/start`: Поток онбординга, создание персонажа, запуск обучения
  * `/help`: Контекстно-зависимая система помощи, список команд, текущий статус дела
  * `/profile`: Характеристики персонажа, обзор прогресса, достижения
  * `/inventory`: Сбор улик, собранные подсказки, заметки
  * `/cases`: Доступные и завершённые дела, отслеживание прогресса
  * `/settings`: Настройки пользователя, уведомления, языковые опции

- **Архитектура обработки сообщений:**
  * Система понимания естественного языка
  * Шаблонное распознавание команд
  * Механизм сохранения контекста
  * Система управления состоянием
  * Для подробных процедур по обработке ошибок и восстановлению см. сводное руководство по ошибкам в Технической Документации
  * Гранулярная реализация ограничения скорости
  * Управление сессиями

- **Спецификации интеграции OpenAI:**
  * Конфигурации конечных точек API
  * Рекомендации по проектированию подсказок
  * Требования к форматированию ответов
  * Управление контекстным окном
  * Оптимизация использования токенов
  * Резервные механизмы (fallback)
  * Стратегия кэширования ответов

### 2. Система интерактивного повествования

- Всеобъемлющий движок ветвления сюжета
- Динамическая генерация диалогов
- Моделирование личности персонажей
- Механизм отслеживания улик
- Система прогресса расследования
- Управление несколькими концовками
- Отслеживание влияния выбора игрока
- Система отношений между персонажами
- Хронологическое отслеживание событий
- Отображение связей между уликами
- Интерфейс построения гипотез
- Формирование сводки дела
- Логика ветвления сюжета на основе решений пользователя
- Интерактивная система кнопок (например, «Допросить подозреваемого», «Осмотреть место преступления»)
- Отслеживание прогресса игрока
- Система влияния решений на исход истории
- Персонализация под предпочтения пользователя
- Динамические реакции персонажей (NPC) с помощью ИИ
- Реалистичные механики разговора во время допроса

### 3. Интеграция мультимедиа

- Система фото-доказательств
- Система аудио-подсказок
- Система видео-доказательств
- Архитектура хранения и доставки мультимедиа

### 4. Монетизация и платёжные системы

#### Детали подписок

- **Бесплатный уровень:**
  * Доступ к одному полноценному делу
  * Базовые инструменты для изучения улик
  * Ограниченное количество взаимодействий в день
  * Стандартное время отклика
  * Базовая система подсказок

- **Премиум-уровень (299 руб./мес.):**
  * Три дополнительных дела
  * Расширенные инструменты работы с уликами
  * Неограниченное количество ежедневных взаимодействий
  * Приоритетное время ответа
  * Улучшенная система подсказок
  * Сохранение прогресса
  * Система достижений

- **VIP-уровень (799 руб./мес.):**
  * Все доступные дела
  * Экспертные инструменты расследования
  * Эксклюзивный контент
  * Мгновенные ответы
  * Расширенная система подсказок
  * Несколько слотов сохранения
  * Особые достижения
  * Ранний доступ к новым делам

#### Система внутриигровых покупок

- **Покупка отдельных кейсов:**
  * Структура цен
  * Механизмы разблокировки
  * Управление доступом
  * Проверка покупки

- **Инструменты расследования:**
  * Анализатор улик
  * Хронологический конструктор (timeline builder)
  * Профайлер персонажей
  * Сравнение показаний (statement comparator)
  * Сканер локации

- **Система подсказок:**
  * Базовые подсказки (бесплатно)
  * Детализированные подсказки (для премиума)
  * Полноценное решение (для VIP)
  * Генерация пользовательских подсказок
  * Механика перезарядки (cooldown)

#### Интеграция YooMoney

- **Реализация API:**
  * Платёжный поток
  * Обработка вебхуков
  * Верификация транзакций
  * Генерация квитанции
  * Возврат средств
  * Обработка ошибок
  * Меры безопасности
- Структура подписок (Free, Premium, VIP)
- Система внутриигровых покупок (подсказки, дополнительные истории)
- Интеграция с YooMoney
- Контроль доступа к премиум-функциям

### 5. Архитектура базы данных

- Отслеживание прогресса пользователей
- Хранение информации о подписках и покупках
- Управление состоянием сюжетов
- Хранение предпочтений пользователей

## Обязательные разделы документа

1. **Обзор архитектуры системы**
   - Диаграммы компонентов
   - Потоки взаимодействия
   - Точки интеграции
   - Вопросы безопасности

2. **Документация пользовательских потоков**
   - Полные сценарии взаимодействия
   - Обработка ошибок (см. консолидированную документацию)
   - Механизмы восстановления сессии

3. **Технические спецификации**
   - Детальные описания функций
   - Спецификации интеграции API
   - Схема базы данных
   - Требования безопасности

4. **Система управления историями**
   - Документация логики ветвления
   - Система управления контентом
   - Точки интеграции с ИИ
   - Спецификация по мультимедиа

5. **Технические требования**
   - Серверные спецификации
   - Требования к базе данных
   - Требования к API
   - Показатели производительности

6. **Сценарии тестирования**
   - Пользовательские тест-кейсы
   - Интеграционное тестирование
   - Тесты производительности
   - Тестирование безопасности

## Базовые требования к историям

Включить спецификации для трёх начальных детективных историй:

1. «Тайна библиотечных теней»
2. «Исчезающая коллекция»
3. «Дело о подделке»

Каждая история должна включать:
- Полную структуру сюжета
- Профили персонажей
- Список улик
- Путь к решению
- Ключевые точки выбора
- Мультимедиа-требования

## Дополнительные спецификации

### Дополнительные критерии приёмки

#### Переход статуса подписки

- Чёткое уведомление при изменении статуса
- Постепенная (graceful) обработка истёкших подписок
- Плавный переход между уровнями подписки
- Прозрачное отображение текущего статуса в профиле

#### Восстановление после ошибок

- Понятные для пользователя сообщения об ошибках
- Оповещение при превышении лимитов на размер файлов
- Автоматические повторы при сбоях в OpenAI API
- Сохранение прогресса при разрыве соединения

### Системные требования истории

#### Управление доказательствами

- Максимальный размер файлов:
  - Изображения: 2 МБ (JPG, PNG)
  - Аудио: 2 минуты (MP3)
  - Видео: 10 МБ / 1 минута (MP4)

#### Прогресс сюжета

- Автосохранение в ключевых точках
- Чёткое указание, какие улики собраны и какие нет
- Отслеживание взаимодействия с персонажами
- Визуализация временной шкалы

### Требования к производительности

#### Время отклика

- Текстовые команды: до 200 мс
- Обработка мультимедиа: до 3 секунд
- Переходы между сюжетами: до 1 секунды

#### Количество одновременных пользователей

- Поддержка более 40 пользователей одновременно
- Стабильная производительность под нагрузкой
- Постепенная деградация при превышении лимитов

### Обновлённые показатели производительности

- Среднее время ответа для текстовых команд: <200 мс
- Обработка мультимедиа (загрузка, доставка): <3 секунд
- Не менее 40 активных сеансов одновременно

## График и бюджет

### Этапы разработки

1. **Планирование и документация (2 недели)**
   - Написание ТЗ: 1 неделя
   - Обзор и правки: 1 неделя
   - Бюджет: 15 000 руб.

2. **Основная разработка (8 недель)**
   - Базовый функционал бота: 2 недели
   - Реализация сюжетного движка: 3 недели
   - Интеграция платежей: 2 недели
   - Тестирование и доработка: 1 неделя
   - Бюджет: 120 000 руб.

3. **Улучшения и запуск (4 недели)**
   - Оптимизация производительности: 1 неделя
   - Усиление безопасности: 1 неделя
   - Тестирование с пользователями: 1 неделя
   - Подготовка к релизу: 1 неделя
   - Бюджет: 65 000 руб.

Общий срок: 14 недель
Общий бюджет: 200 000 руб.

*Для дополнительных технических подробностей см. сводную документацию `consolidated-docs.md`.*