# План аварийного восстановления

## 1. Обзор

DRP (Disaster Recovery Plan) гарантирует, что Sherlock AI остаётся работоспособным при сбоях системы, потере данных или неожиданном простое. Ниже — стратегии бэкапов, механизмы failover и протоколы инцидентов.

* * *

## 2. Бэкапы

### 2.1 Частота

* **Инкрементальные**: раз в 24 часа (прогресс, пользовательские данные)
* **Полные**: раз в неделю (вся БД)
* **Транзакции**: раз в неделю (отдельно)

### 2.2 Хранилище

* **Основное**: облако с шифрованием
* **Резервное**: локальный сервер
* **Внешнее**: ежемесячный офсайт

### 2.3 Сроки хранения

| Тип | Срок |
| --- | --- |
| Прогресс игрока | 90 дн. |
| Логи транзакций | 1 год |
| Логи системы | 30 дн. |
| Отчёты об ошибках | 14 дн. |
| Полные бэкапы | 6 мес. |

### 2.4 Проверка бэкапов

* **Автоматические проверки** целостности
* **Тестовое восстановление** каждые 2 недели
* **Уведомления** при сбоях бэкапа

* * *

## 3. Восстановление системы

### 3.1 Процедуры failover

* **Основная БД** -> переключение на **реплику**
* **API-сбои** -> очередь запросов
* **Хранилище** -> резервный CDN
* **Сбой бота** -> autorestart (systemd)

### 3.2 Проверка целостности

* **Мониторинг в реальном времени**
* **Откат транзакций** при частичном сбое
* **Сохранение сессии** (продолжение игры)

### 3.3 Процесс восстановления

| Тип инцидента | Реакция | Макс. время |
| --- | --- | --- |
| Мелкий сбой сервиса | перезапуск | < 5 мин |
| Повреждение базы | реплика / бэкап | < 1 ч |
| Сбой API | очередь запросов | < 2 ч |
| Утрата данных | восстановление | < 12 ч |

### 3.4 Оповещение пользователей

* **Страница статуса** в реальном времени
* **Автоматические уведомления** о простое
* **Поддержка**: ответ в течение 24 часов

### 3.5 Документация инцидентов

* **Post-mortem** для крупных случаев
* **RCA** (Root Cause Analysis)
* **Устранение первопричин**
* **Обновление инфраструктуры**

* * *

## 4. План реализации

### 4.1 Шаги

1. Настроить ежедневные и недельные бэкапы
2. Запуск failover для БД/API/бота
3. Реальный тайм мониторинг целостности
4. Страница статуса
5. Протокол инцидентов

### 4.2 Тестирование

* **Симуляции** раз в квартал
* **Восстановление из бэкапа** проверка
* **Нагрузочные** условия
* **Проверка непрерывности**

* * *

## 5. Приоритет и действия

### 5.1 Уровень важности: Средний

Базовая DR должна быть **до релиза**, с дальнейшим улучшением.

### 5.2 Дальнейшие шаги

1. Автоматизация бэкапа и мониторинга
2. Тест-файловер
3. Уведомления о сбоях
4. Документация аварий
5. Регулярные учения

* * *

## 6. Зависимости

* **DBA** для целостности
* **Инфраструктурщики** для серверов
* **Поддержка** для общения с пользователями
* **Безопасники** для шифрования