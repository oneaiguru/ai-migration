# Руководство по настройке API-доступа Bitrix для интеграции с системой переписывания текстов

## Введение

Уважаемый администратор сайта,

Для интеграции системы автоматического переписывания текстов с вашим сайтом на Bitrix, нам необходимо настроить безопасный API-доступ. Это руководство подробно описывает все действия, которые вам нужно выполнить без предоставления полного административного доступа к сайту.

## Необходимые шаги

### 1. Создайте веб-хук для доступа к API Bitrix

1. Войдите в административную панель Bitrix.
2. Перейдите в раздел **Настройки** → **Инструменты разработчика** → **Веб-хуки** (или **Webhooks**).
3. Нажмите кнопку **Добавить веб-хук**.
4. Укажите следующие параметры:
   - **Пользователь**: рекомендуется создать отдельного пользователя с ограниченными правами для интеграции
   - **Название**: "Система переписывания текстов" (или любое другое понятное вам название)
   - **Срок действия**: рекомендуется 1 год
   - **Права доступа**: отметьте следующие права:
     - `catalog` (общий доступ к каталогу)
     - `catalog.element.read` (чтение элементов каталога)
     - `catalog.element.write` (изменение элементов каталога)
     - `iblock` (общий доступ к инфоблокам)
     - `iblock.element.read` (чтение элементов инфоблоков)
     - `iblock.element.write` (изменение элементов инфоблоков)

5. Нажмите **Сохранить**.
6. После сохранения, вы получите URL веб-хука вида:
   ```
   https://your-domain.ru/rest/1/abc123xyz/
   ```
   **Важно**: Сохраните этот URL, он понадобится для заполнения формы.

![Пример создания веб-хука в Bitrix](https://i.imgur.com/ExampleWebhook.png)

### 2. Запустите скрипт проверки API-доступа

1. Скачайте файл `bitrix_api_check.php` из приложения к этому письму.
2. Откройте этот файл в любом текстовом редакторе.
3. Найдите раздел настроек подключения в начале файла:
   ```php
   $BITRIX_SETTINGS = [
       'endpoint' => 'https://your-domain.ru/rest',
       
       // Выберите один из способов авторизации
       
       // 1. Через веб-хук (рекомендуется)
       'auth_type' => 'webhook',
       'webhook' => 'https://your-domain.ru/rest/1/abc123xyz/',
       
       // 2. Через логин и пароль (альтернативный вариант)
       // 'auth_type' => 'basic',
       // 'login' => 'admin',
       // 'password' => 'your_password',
       
       'timeout' => 30,
   ];
   ```
4. Замените значения на актуальные для вашего сайта:
   - Если вы создали веб-хук: укажите его полный URL в поле `webhook` и убедитесь, что `auth_type` установлен в `webhook`
   - Если хотите использовать логин/пароль: раскомментируйте соответствующие строки, укажите учетные данные и установите `auth_type` в `basic`
5. Сохраните файл.
6. Загрузите файл на ваш сервер (например, через FTP) в любую доступную директорию.
7. Запустите скрипт, открыв его в браузере или через командную строку:
   ```
   php bitrix_api_check.php
   ```
8. Скрипт выполнит проверку подключения к API Bitrix и выведет подробную информацию о результатах.
9. **Важно**: Сохраните полный текст результатов выполнения скрипта и отправьте его разработчику для настройки интеграции.

### 3. Заполните форму с информацией для интеграции

Пожалуйста, заполните следующую форму и отправьте её разработчику:

```
=== ИНФОРМАЦИЯ ДЛЯ ИНТЕГРАЦИИ С BITRIX ===

1. Базовый URL REST API Bitrix:
[например: https://www.souz-pribor.ru/rest]

2. Данные для доступа (заполните ОДИН из вариантов):
   
   а) Веб-хук для доступа:
   Webhook URL: _______________
   
   б) Или логин и пароль для доступа:
   Логин: _____________________
   Пароль: ____________________

3. Структура товарных каталогов:
   - ID инфоблока каталога товаров: ___________
   - Название поля с описанием товара: [обычно DETAIL_TEXT]
   - Тип описания: [HTML или текст]

4. Особенности работы с товарами:
   - Используете ли торговые предложения? (да/нет): _________
   - Есть ли товары с разными языковыми версиями? (да/нет): ________
   - Особые требования к форматированию описаний: _________________

5. Результаты выполнения скрипта проверки API:
   [ВСТАВЬТЕ СЮДА ПОЛНЫЙ ВЫВОД СКРИПТА bitrix_api_check.php]

=== КОНЕЦ ФОРМЫ ===
```

## Часто задаваемые вопросы

### Насколько безопасен этот метод?
Создание веб-хука с ограниченными правами доступа - стандартный и безопасный метод интеграции с Bitrix. Веб-хук имеет доступ только к указанным при создании функциям API и не имеет полного административного доступа.

### Повлияет ли интеграция на производительность сайта?
Нет, система выполняет только точечные запросы к API и не создает значительной нагрузки на сервер. Все операции по переписыванию текстов выполняются вне вашего сервера.

### Можно ли ограничить доступ к определенным разделам каталога?
Да, это возможно через настройку прав доступа пользователя, от имени которого создается веб-хук. Если вам требуется такое ограничение, пожалуйста, укажите это в форме.

### Что делать, если возникли проблемы при выполнении скрипта проверки?
Если скрипт выдает ошибки, пожалуйста, отправьте полный текст ошибки разработчику. Наиболее распространенные причины проблем:
- Неверный URL веб-хука
- Недостаточные права доступа
- Проблемы с настройками PHP на сервере

## Контактная информация

Если у вас возникли вопросы или сложности при выполнении инструкции, пожалуйста, свяжитесь с разработчиком:

Email: m@granin.com
Telegram: @granin

---

© 2025, Гранин Михаил Николаевич
