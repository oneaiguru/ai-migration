---
sidebar_position: 3
---

# Изменения по КП

## Каfka

### Отправка изменений по КП

> **POST exportChangeRequestToLk**

`https://{host_name}/app/api/v1/admin/task/exportChangeRequestToLk?id=9e13b805-f93e-4ad9-bda6-e3a2bcbafd08`

| PARAMS | value | **Комментарий** |
|--------|-------|-----------------|
| id | 9e13b805-f93e-4ad9-bda6-e3a2bcbafd08 | id change_request |

В Кафку отправляются только поля, измененные при редактировании КП в реестре.

**CHANGE_REQUEST_DSP_TO_LK\_{server_name}**, где server_name - суффикс сервера.

<details>
<summary>Результат</summary>

```json
{
    "id": "a1c101ae-80df-484c-bc0f-9767d53c20a1",                         // ID ChangeRequest
    "source": "UI",                                                       // Источник изменения (ручное изменение через интерфейс)
    "operation": "UPDATE",                                                // Тип операции
    "entityName": "dsp_ContainerArea",                                    // Таблица, в которую было внесено изменение
    "instanceKey": {                                                      // Ключ изменяемой записи
        "id": "2c9b036b-3755-4810-9764-7d7ed8796d5e",                     // ID контейнерной площадки
        "lkId": "2c9b036b-3755-4810-9764-7d7ed8796d5e",                   // ID контейнерной площадки (lk_code)
        "lkCode": "78900417"                                              // Код контейнерной площадки (lk_code)
    },
    "attributes": [                                                       // Измененные данные
        {
            "id": "40ccae07-71a3-451d-a518-8af8bd7ac91a",                 // ID изменения контейнерной группы
            "name": "containerGroups",                                    // Изменение контейнерной группы
            "value": [                                                    // Измененное значение
                {
                    "id": "ef457fcf-d395-47bf-a2e2-26b84049238a",         // ID изменения во вложенном объекте
                    "source": "UI",                                       // Источник изменения (ручное изменение через интерфейс)
                    "operation": "UPDATE",                                // Тип операции во вложенном объекте
                    "entityName": "dsp_ContainerGroup",                   // Измененная таблица во вложенном объекте
                    "instanceKey": {                                      // Ключ изменяемой записи во вложенном объекте
                        "id": "35c9fb70-560b-4de5-87ca-243655fe497d",     // ID группы контейнеров
                        "oldId": "66fd300a-c690-42ce-8f3b-a71ab5e658a4"   // Старый ID группы контейнеров
                    },
                    "attributes": [                                       // Измененные данные во вложенном объекте
                        {
                            "id": "eb82da9f-8fc9-4bc9-8173-daa7f97d5b0f", // ID атрибута
                            "decisionMode": "ACCEPT",
                            "decision": "ACCEPTED",
                            "decisionTs": "2024-06-03T15:56:32.045Z",     // Время изменения
                            "name": "amount",                             // Название измененного параметра
                            "value": 2                                    // Новое значение параметра (изменено количество контейнеров)
                        }
                    ],
                    "requestTs": "2024-06-03T15:56:32.045Z",              // Время изменения во вложенном объекте
                    "requestedBy": "Системный Администратор"              // Пользователь, выполнивший изменение во вложенном объекте
                }
            ]
        }
    ],
    "reason": "",                                                         // Причина изменения (в данном случае отсутствует)
    "requestTs": "2024-06-03T15:56:32.048Z",                              // Время запроса на изменение
    "requestedBy": "Системный Администратор"                              // Пользователь, выполнивший изменение
}
```

</details>
