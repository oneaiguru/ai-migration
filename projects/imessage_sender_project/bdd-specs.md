# BDD-спецификации системы рассылки iMessage

## Введение

Данный документ содержит спецификации поведения (Behavior-Driven Development) для системы рассылки iMessage. Спецификации написаны в формате Gherkin и описывают функциональность системы с точки зрения пользователя.

## Функциональность: Загрузка контактов

```gherkin
# language: ru
Функционал: Загрузка контактов для рассылки
  Как пользователь системы
  Я хочу загружать списки контактов из различных форматов файлов
  Чтобы не вводить их вручную и управлять аудиторией рассылки

  Сценарий: Загрузка контактов из CSV-файла
    Дано файл CSV с контактами "contacts.csv"
    Когда я загружаю файл контактов
    Тогда система должна успешно загрузить все контакты
    И сообщить количество загруженных контактов
    И показать список загруженных контактов в интерфейсе

  Сценарий: Загрузка контактов из EXCEL-файла
    Дано файл Excel с контактами "contacts.xlsx"
    Когда я загружаю файл контактов
    Тогда система должна успешно загрузить все контакты
    И сообщить количество загруженных контактов
    И показать список загруженных контактов в интерфейсе

  Сценарий: Загрузка контактов из TXT-файла
    Дано текстовый файл с номерами телефонов "phones.txt"
    Когда я загружаю файл контактов
    Тогда система должна успешно загрузить все контакты
    И сообщить количество загруженных контактов
    И показать список загруженных контактов в интерфейсе

  Сценарий: Валидация номеров телефонов при загрузке
    Дано файл с контактами, содержащий некорректные номера телефонов
    Когда я загружаю файл контактов
    Тогда система должна отфильтровать номера с некорректным форматом
    И сообщить количество загруженных и отфильтрованных контактов
    И показать только корректные контакты в интерфейсе

  Сценарий: Дедупликация контактов при загрузке
    Дано файл с контактами, содержащий повторяющиеся номера телефонов
    Когда я загружаю файл контактов
    Тогда система должна удалить дубликаты номеров
    И сообщить количество уникальных загруженных контактов
    И показать только уникальные контакты в интерфейсе
```

## Функциональность: Шаблоны сообщений

```gherkin
# language: ru
Функционал: Шаблоны сообщений
  Как пользователь системы
  Я хочу создавать и использовать шаблоны сообщений с переменными
  Чтобы персонализировать сообщения для каждого получателя

  Сценарий: Создание нового шаблона сообщения
    Когда я создаю новый шаблон сообщения
    И ввожу текст шаблона с переменными "{{ name }}" и "{{ date }}"
    И сохраняю шаблон с названием "Новый шаблон"
    Тогда система должна сохранить шаблон
    И показать его в списке доступных шаблонов

  Сценарий: Загрузка шаблона из файла
    Дано файл шаблона "template.txt"
    Когда я загружаю файл шаблона
    Тогда система должна успешно загрузить шаблон
    И показать его содержимое в редакторе
    И определить все переменные в шаблоне

  Сценарий: Предварительный просмотр персонализированного сообщения
    Дано загруженный шаблон с переменными "{{ name }}" и "{{ company }}"
    И загруженный контакт с данными для этих переменных
    Когда я выбираю функцию предварительного просмотра
    Тогда система должна показать сообщение с подставленными значениями переменных
    И заменить "{{ name }}" на имя из контакта
    И заменить "{{ company }}" на название компании из контакта

  Сценарий: Экспорт и импорт шаблонов
    Дано созданный шаблон сообщения
    Когда я экспортирую шаблон в файл
    И затем импортирую этот файл в другом сеансе
    Тогда система должна восстановить шаблон без изменений
    И показать его в списке доступных шаблонов
```

## Функциональность: Отправка сообщений

```gherkin
# language: ru
Функционал: Отправка сообщений
  Как пользователь системы
  Я хочу отправлять сообщения на загруженные контакты
  Чтобы автоматизировать коммуникацию с клиентами

  Сценарий: Отправка одиночного тестового сообщения
    Дано загруженный контакт и шаблон сообщения
    Когда я выбираю функцию отправки тестового сообщения
    И указываю контакт для отправки
    Тогда система должна отправить одно сообщение на указанный контакт
    И показать результат отправки
    И записать информацию об отправке в лог

  Сценарий: Отправка массовой рассылки
    Дано загруженный список контактов и шаблон сообщения
    Когда я выбираю функцию массовой рассылки
    И указываю интервал между сообщениями от 3 до 7 секунд
    И запускаю рассылку
    Тогда система должна начать отправку сообщений на все контакты
    И соблюдать указанный интервал между отправками
    И показывать прогресс отправки
    И записывать информацию о каждой отправке в лог

  Сценарий: Отправка сообщения с медиафайлом
    Дано загруженный контакт и шаблон сообщения
    И выбранный медиафайл для отправки
    Когда я отправляю сообщение
    Тогда система должна отправить сообщение с прикрепленным медиафайлом
    И показать результат отправки
    И записать информацию об отправке в лог

  Сценарий: Остановка массовой рассылки
    Дано запущенная массовая рассылка
    Когда я нажимаю кнопку "Остановить рассылку"
    Тогда система должна прекратить отправку новых сообщений
    И показать статистику уже отправленных сообщений
    И записать в лог информацию о прерывании рассылки

  Сценарий: Обработка ошибок при отправке
    Дано загруженный список контактов с одним некорректным номером
    И шаблон сообщения
    Когда я запускаю рассылку
    Тогда система должна продолжить отправку после ошибки на некорректном номере
    И отобразить ошибки в журнале отправки
    И показать количество успешно отправленных и неудачных сообщений
```

## Функциональность: Логирование и отчеты

```gherkin
# language: ru
Функционал: Логирование и отчеты
  Как пользователь системы
  Я хочу видеть подробные логи и получать отчеты о рассылках
  Чтобы контролировать результаты и анализировать эффективность

  Сценарий: Просмотр журнала отправки
    Дано выполненная рассылка на несколько контактов
    Когда я открываю журнал отправки
    Тогда система должна показать список всех отправленных сообщений
    И для каждого сообщения должен быть указан статус, получатель и время отправки
    И должна быть возможность фильтрации по статусу и дате

  Сценарий: Генерация отчета о рассылке
    Дано выполненная рассылка на несколько контактов
    Когда я запрашиваю генерацию отчета
    И выбираю формат отчета "PDF"
    Тогда система должна создать отчет с информацией о рассылке
    И отчет должен содержать статистику отправки и список получателей
    И система должна предложить сохранить отчет в указанном формате

  Сценарий: Экспорт логов в различные форматы
    Дано выполненная рассылка с записями в логе
    Когда я выбираю функцию экспорта логов
    И указываю формат "CSV" или "JSON" или "TXT"
    Тогда система должна экспортировать логи в указанный формат
    И предложить сохранить файл экспорта
    И экспортированный файл должен содержать все записи из лога

  Сценарий: Автоматическое создание бэкапов логов
    Дано система с настроенным автоматическим бэкапом логов
    Когда размер файла лога превышает 10 МБ
    Тогда система должна создать новый файл лога
    И архивировать предыдущий файл лога
    И сохранить не более 5 архивных файлов
```

## Функциональность: Настройки системы

```gherkin
# language: ru
Функционал: Настройки системы
  Как пользователь системы
  Я хочу настраивать параметры работы системы
  Чтобы адаптировать ее под свои потребности

  Сценарий: Изменение интервалов отправки
    Когда я открываю настройки системы
    И изменяю минимальный интервал на 5 секунд
    И изменяю максимальный интервал на 10 секунд
    И сохраняю настройки
    Тогда система должна использовать новые интервалы при отправке
    И сохранить эти значения для следующих сеансов

  Сценарий: Настройка путей к директориям
    Когда я открываю настройки системы
    И изменяю путь к директории логов
    И изменяю путь к директории шаблонов
    И сохраняю настройки
    Тогда система должна использовать новые пути для доступа к файлам
    И создать указанные директории, если они не существуют

  Сценарий: Настройка параметров логирования
    Когда я открываю настройки системы
    И изменяю уровень логирования на "DEBUG"
    И включаю вывод логов в консоль
    И сохраняю настройки
    Тогда система должна вести более подробное логирование
    И дублировать записи лога в консоль

  Сценарий: Сброс настроек к значениям по умолчанию
    Когда я открываю настройки системы
    И выбираю функцию сброса настроек
    И подтверждаю действие
    Тогда система должна восстановить все настройки по умолчанию
    И обновить интерфейс настроек с новыми значениями
```

## Функциональность: Мультиаккаунт

```gherkin
# language: ru
Функционал: Поддержка нескольких аккаунтов iMessage
  Как пользователь системы
  Я хочу использовать несколько аккаунтов iMessage для рассылки
  Чтобы распределить нагрузку и избежать блокировки отдельных аккаунтов

  Сценарий: Добавление нового аккаунта
    Когда я открываю настройки аккаунтов
    И выбираю функцию добавления нового аккаунта
    И указываю данные аккаунта
    И сохраняю настройки
    Тогда система должна добавить аккаунт в список доступных
    И проверить возможность отправки через этот аккаунт

  Сценарий: Распределение рассылки между аккаунтами
    Дано несколько настроенных аккаунтов iMessage
    И загруженный список контактов
    Когда я запускаю массовую рассылку
    И выбираю опцию "Распределять между аккаунтами"
    Тогда система должна отправлять сообщения через разные аккаунты
    И распределять нагрузку равномерно между аккаунтами
    И показывать статистику отправки по каждому аккаунту

  Сценарий: Отключение проблемного аккаунта
    Дано несколько настроенных аккаунтов iMessage
    И запущенная рассылка
    Когда один из аккаунтов начинает возвращать ошибки
    Тогда система должна временно отключить проблемный аккаунт
    И продолжить рассылку через остальные аккаунты
    И уведомить пользователя о проблеме с аккаунтом

  Сценарий: Ротация аккаунтов по расписанию
    Дано несколько настроенных аккаунтов iMessage
    И настроенное расписание ротации
    Когда наступает время ротации
    Тогда система должна переключиться на следующий аккаунт
    И записать в лог информацию о ротации
    И продолжить рассылку через новый активный аккаунт
```

## Функциональность: Графический интерфейс

```gherkin
# language: ru
Функционал: Графический интерфейс пользователя
  Как пользователь системы
  Я хочу использовать удобный графический интерфейс
  Чтобы эффективно управлять рассылками и контактами

  Сценарий: Запуск приложения и отображение главного окна
    Когда я запускаю приложение
    Тогда система должна показать главное окно
    И загрузить последние использованные настройки
    И показать состояние системы и статистику в главном окне

  Сценарий: Управление контактами через интерфейс
    Когда я открываю вкладку "Контакты"
    Тогда система должна показать список загруженных контактов
    И предоставить функции импорта, экспорта и редактирования контактов
    И позволить фильтровать и сортировать список контактов

  Сценарий: Управление шаблонами через интерфейс
    Когда я открываю вкладку "Шаблоны"
    Тогда система должна показать список доступных шаблонов
    И предоставить функции создания, редактирования и предпросмотра шаблонов
    И показать список переменных, используемых в каждом шаблоне

  Сценарий: Управление рассылкой через интерфейс
    Когда я открываю вкладку "Рассылка"
    Тогда система должна показать форму настройки рассылки
    И позволить выбрать контакты и шаблон для рассылки
    И предоставить органы управления рассылкой (старт, пауза, стоп)
    И показывать статус и прогресс рассылки в реальном времени

  Сценарий: Отображение логов и отчетов в интерфейсе
    Когда я открываю вкладку "Логи и отчеты"
    Тогда система должна показать журнал событий
    И предоставить функции фильтрации, поиска и экспорта логов
    И позволить генерировать и просматривать отчеты о рассылках
```

## Матрица отслеживания требований

| ID  | Требование                                       | Приоритет | Сценарии                                          | Статус      |
|-----|--------------------------------------------------|-----------|---------------------------------------------------|-------------|
| R01 | Загрузка контактов из различных форматов         | Высокий   | Загрузка контактов из CSV/EXCEL/TXT-файла         | Реализовано |
| R02 | Валидация и дедупликация номеров                 | Высокий   | Валидация номеров, Дедупликация контактов         | Реализовано |
| R03 | Шаблонизация сообщений                           | Высокий   | Создание шаблона, Предварительный просмотр        | Реализовано |
| R04 | Отправка одиночных и массовых сообщений          | Высокий   | Отправка тестового, Отправка массовой рассылки   | Реализовано |
| R05 | Задержки между отправками                        | Высокий   | Отправка массовой рассылки, Изменение интервалов  | Реализовано |
| R06 | Логирование процесса отправки                    | Средний   | Все сценарии логирования                          | Реализовано |
| R07 | Обработка ошибок при отправке                    | Средний   | Обработка ошибок при отправке                     | Реализовано |
| R08 | Поддержка медиафайлов                            | Средний   | Отправка сообщения с медиафайлом                  | Реализовано |
| R09 | Остановка и пауза рассылки                       | Средний   | Остановка массовой рассылки                       | Реализовано |
| R10 | Генерация отчетов                                | Средний   | Генерация отчета о рассылке                       | Реализовано |
| R11 | Настройка параметров системы                     | Средний   | Все сценарии настроек                             | Реализовано |
| R12 | Поддержка нескольких аккаунтов                   | Низкий    | Все сценарии мультиаккаунта                       | В разработке |
| R13 | Графический интерфейс                            | Средний   | Все сценарии графического интерфейса              | Реализовано |
| R14 | Экспорт и импорт настроек                        | Низкий    | Экспорт и импорт шаблонов                         | Реализовано |
| R15 | Автоматическое бэкапирование логов               | Низкий    | Автоматическое создание бэкапов логов             | Реализовано |

## Определение готовности (Definition of Done)

1. **Базовые требования**:
   - Реализован код, соответствующий BDD-спецификациям
   - Написаны и пройдены модульные тесты
   - Код соответствует стандартам PEP 8
   - Документация обновлена

2. **Требования к тестированию**:
   - Пройдены все модульные тесты (>90% покрытия)
   - Проведено ручное тестирование на реальных устройствах
   - Проверка на различных версиях macOS (12+)
   - Проверка с разными наборами контактов и шаблонов

3. **Требования к документации**:
   - Обновлена документация пользователя
   - Обновлена техническая документация
   - Подготовлены примеры использования
   - Описаны известные ограничения и проблемы

4. **Требования к развертыванию**:
   - Подготовлен установочный скрипт
   - Созданы и протестированы сценарии установки и обновления
   - Подготовлены примеры конфигурационных файлов
   - Проверена совместимость со всеми зависимостями

5. **Критерии приемки**:
   - Демонстрация работающей системы
   - Успешная отправка тестовых сообщений
   - Проверка всех функций, описанных в BDD-спецификациях
   - Подписание акта приемки-передачи
