# iMessage Sender - Руководство пользователя и документация

## Введение

iMessage Sender - это мощный инструмент для отправки персонализированных сообщений iMessage нескольким получателям. Система позволяет:

- Импортировать контакты из файлов CSV, Excel и текстовых файлов
- Создавать и использовать шаблоны сообщений с переменными
- Отправлять массовые сообщения с настраиваемыми задержками
- Отслеживать статус доставки сообщений
- Генерировать отчеты по кампаниям рассылки

Эта документация предоставляет всю необходимую информацию для настройки, тестирования и использования системы iMessage Sender.

## Содержание

1. [Системные требования](#системные-требования)
2. [Установка](#установка)
3. [Начало работы](#начало-работы)
4. [Обзор возможностей](#обзор-возможностей)
5. [Работа с контактами](#работа-с-контактами)
6. [Использование шаблонов сообщений](#использование-шаблонов-сообщений)
7. [Отправка сообщений](#отправка-сообщений)
8. [Лучшие практики тестирования](#лучшие-практики-тестирования)
9. [Устранение неполадок](#устранение-неполадок)
10. [Техническая документация](#техническая-документация)

## Системные требования

- macOS 12.0 или новее
- Python 3.7 или новее
- Messages.app с настроенным активным Apple ID
- Интернет-соединение для установки зависимостей

## Установка

### Автоматическая установка

1. Распакуйте ZIP-архив iMessage Sender в выбранное место.
2. Откройте Terminal и перейдите в распакованную папку:
   ```
   cd /путь/к/imessage_sender
   ```
3. Запустите установочный скрипт:
   ```
   ./launch_imessage_sender.command
   ```
   Этот скрипт создаст виртуальное окружение и установит все зависимости.

### Ручная установка

1. Распакуйте ZIP-архив iMessage Sender.
2. Откройте Terminal и перейдите в распакованную папку.
3. Создайте виртуальное окружение:
   ```
   python3 -m venv venv
   ```
4. Активируйте виртуальное окружение:
   ```
   source venv/bin/activate
   ```
5. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```

## Начало работы

### Начальная настройка

После установки настройте систему:

1. Запустите приложение:
   ```
   python3 gui.py
   ```
   (Если используете командный скрипт: `./launch_imessage_sender.command`)

2. Перейдите на вкладку Настройки и настройте:
   - Расположение файла журнала
   - Директорию шаблонов
   - Задержку между сообщениями по умолчанию (рекомендуется: 3-7 секунд)
   - Другие параметры

3. Проверьте конфигурацию, отправив тестовое сообщение на свой собственный номер.

## Обзор возможностей

### Управление контактами

- Импорт контактов из файлов CSV, Excel и текстовых файлов
- Автоматическая валидация номеров телефонов
- Обнаружение и обработка дубликатов контактов
- Экспорт контактов в различные форматы

### Шаблоны сообщений

- Создание шаблонов с переменными-заполнителями
- Поддержка специальных переменных, таких как дата и время
- Предварительный просмотр шаблонов с примерными данными
- Сохранение и загрузка шаблонов из файлов

### Отправка сообщений

- Отправка индивидуальным контактам или в массовом режиме
- Добавление медиавложений (изображения, документы)
- Настройка задержек между сообщениями
- Мониторинг прогресса отправки

### Отчетность

- Отслеживание статуса доставки сообщений
- Генерация отчетов об отправке
- Экспорт журналов в различных форматах

## Работа с контактами

### Поддерживаемые форматы файлов

- **CSV**: Стандартные файлы со значениями, разделенными запятыми
- **Excel**: Файлы XLSX с данными контактов
- **TXT**: Простые текстовые файлы с одним номером телефона на строку

### Формат CSV

Рекомендуемый формат CSV включает как минимум следующие столбцы:
- `phone` (обязательно): Номер телефона для отправки
- `name` (опционально): Имя получателя
- Дополнительные столбцы могут использоваться как переменные в шаблонах

Пример:
```csv
phone,name,company,event
+11234567890,Иван Иванов,ООО "Компания",запуск продукта
+10987654321,Мария Петрова,ЗАО "Корпорация",тренинг
```

### Формат номера телефона

Номера телефонов должны быть в международном формате:
- Начинаться с + и кода страны: `+11234567890`
- Система попытается правильно отформатировать российские номера телефонов (преобразовать 8 в +7)

### Импорт контактов

1. Перейдите на вкладку Контакты
2. Нажмите "Импортировать контакты"
3. Выберите формат файла и найдите ваш файл
4. Просмотрите импортированные контакты
5. Исправьте проблемы валидации при необходимости

## Использование шаблонов сообщений

### Переменные шаблона

Используйте двойные фигурные скобки для определения переменных:
```
Здравствуйте, {{ name }}!

Напоминаем вам о {{ event }} {{ date }}.

С уважением,
{{ company }}
```

### Специальные переменные

Доступны следующие специальные переменные:
- `{{ date }}`: Текущая дата (формат: ДД.ММ.ГГГГ)
- `{{ time }}`: Текущее время (формат: ЧЧ:ММ)
- `{{ datetime }}`: Комбинированные дата и время
- `{{ year }}`, `{{ month }}`, `{{ day }}`: Отдельные компоненты даты
- `{{ hour }}`, `{{ minute }}`: Отдельные компоненты времени

### Создание шаблонов

1. Перейдите на вкладку Шаблоны
2. Нажмите "Новый шаблон"
3. Напишите сообщение с переменными
4. Просмотрите с примерными данными
5. Сохраните шаблон в файл

## Отправка сообщений

### Тестовая отправка

Всегда тестируйте настройки перед отправкой нескольким получателям:

1. Импортируйте небольшой файл контактов (или добавьте тестовый контакт вручную)
2. Создайте и выберите шаблон
3. Нажмите "Тестовая отправка" для отправки одному контакту (предпочтительно себе)
4. Убедитесь, что сообщение получено корректно

### Массовая отправка

Для отправки нескольким контактам:

1. Импортируйте ваши контакты
2. Выберите шаблон
3. Настройте параметры отправки (задержки, размер пакета)
4. Нажмите "Начать отправку"
5. Отслеживайте прогресс

### Рекомендуемые практики отправки

- **Начинайте с малого**: С 5-10 контактов
- **Внимательно отслеживайте**: Следите за проблемами или ограничениями
- **Используйте разумные задержки**: Не менее 3-5 секунд между сообщениями
- **Соблюдайте дневные лимиты**: Не более 500-1000 сообщений в день
- **Отправляйте в подходящее время**: Избегайте очень поздних или ранних часов

## Лучшие практики тестирования

### Режимы тестирования

Система поддерживает различные режимы тестирования:

- **Режим имитации**: Имитирует отправку без фактической отправки сообщений
- **Реальный режим**: Действительно отправляет сообщения через Messages.app

### Использование режима имитации

Для тестирования без фактической отправки сообщений:

```bash
python test_files/send_test_message.py +11234567890 --mock
```

Это имитирует процесс отправки без фактической отправки сообщений.

### Тестирование рендеринга шаблона

Чтобы проверить правильность рендеринга шаблона:

1. Перейдите на вкладку Шаблоны
2. Загрузите шаблон
3. Нажмите "Предпросмотр"
4. Убедитесь, что все переменные заменены корректно

### Тестирование импорта контактов

Чтобы проверить правильность списка контактов:

1. Импортируйте файл контактов
2. Проверьте количество успешно импортированных контактов
3. Убедитесь, что номера телефонов отформатированы корректно
4. Проверьте предупреждения валидации

## Устранение неполадок

### Распространенные проблемы

#### Сообщения не отправляются

- Убедитесь, что Messages.app запущен и вы вошли в систему
- Проверьте правильность настройки Apple ID
- Убедитесь в наличии работающего интернет-соединения
- Проверьте, может ли получатель получать iMessages

#### Проблемы импорта

- Проверьте формат файла (кодировку, имена столбцов)
- Проверьте наличие специальных символов в файле
- Убедитесь, что необходимые столбцы (phone) присутствуют
- Попробуйте другой формат файла при необходимости

#### Проблемы с шаблоном

- Убедитесь, что все имена переменных соответствуют данным ваших контактов
- Проверьте синтаксис заполнителей переменных
- Ищите опечатки в именах переменных

### Файлы журнала

Приложение ведет подробные журналы, которые могут помочь в устранении проблем:

- Проверьте директорию журналов на наличие файлов журнала
- Ищите сообщения уровня ERROR или WARNING
- Экспортируйте журналы для помощи в устранении неполадок

## Техническая документация

### Параметры командной строки

Система включает несколько инструментов командной строки для продвинутого использования:

#### Тестовый CLI

```bash
python test_cli.py --run-all                # Запуск всех тестов
python test_cli.py --test-module test_basic # Запуск определенных тестов
python test_cli.py --mode mock --contacts file.csv --template template.txt --test-send  # Тестирование с имитацией отправки
```

#### Отправка тестового сообщения

```bash
python test_files/send_test_message.py +11234567890           # Отправка на конкретный номер
python test_files/send_test_message.py +11234567890 --mock    # Тестирование без отправки
python test_files/send_test_message.py +11234567890 --template test_files/template.txt  # Использование определенного шаблона
```

### Структура файлов

Приложение имеет следующую структуру:

- `contact_manager.py`: Функциональность управления контактами
- `message_template.py`: Обработка шаблонов
- `imessage_sender.py`: Основная функциональность отправки
- `logger.py`: Система логирования
- `config.py`: Управление конфигурацией
- `gui.py`: Графический пользовательский интерфейс
- `requirements.txt`: Зависимости
- `templates/`: Директория для сохраненных шаблонов
- `logs/`: Директория для файлов журнала
- `test_files/`: Тестовые утилиты и ресурсы

### Безопасность и приватность

Это приложение:
- Отправляет сообщения только через ваш собственный Messages.app
- Не передает ваши контакты или сообщения третьим сторонам
- Работает полностью на вашем локальном компьютере
- Соблюдает рекомендации Apple по обмену сообщениями

### Лучшие практики для производственного использования

1. **Начинайте с малых партий**: Начинайте с 5-10 контактов
2. **Используйте разумные задержки**: Рекомендуется 3-7 секунд между сообщениями
3. **Придерживайтесь лимитов**: Не более 500-1000 сообщений в день
4. **Следите за блокировками**: Наблюдайте за признаками ограничения скорости
5. **Используйте качественные списки**: Убедитесь, что контакты валидны и проверены
6. **Уважайте время обмена сообщениями**: Отправляйте в подходящее время
7. **Тщательно тестируйте**: Всегда тестируйте шаблоны и процессы перед массовой отправкой
