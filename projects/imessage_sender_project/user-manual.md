# Руководство пользователя

## Система рассылки iMessage

_Версия 1.0.0_

## Содержание

1. [Введение](#введение)
2. [Установка](#установка)
   - [Системные требования](#системные-требования)
   - [Автоматическая установка](#автоматическая-установка)
   - [Ручная установка](#ручная-установка)
3. [Начало работы](#начало-работы)
   - [Запуск приложения](#запуск-приложения)
   - [Обзор интерфейса](#обзор-интерфейса)
4. [Работа с контактами](#работа-с-контактами)
   - [Загрузка контактов](#загрузка-контактов)
   - [Форматы файлов контактов](#форматы-файлов-контактов)
   - [Поиск и фильтрация контактов](#поиск-и-фильтрация-контактов)
   - [Экспорт контактов](#экспорт-контактов)
5. [Работа с шаблонами](#работа-с-шаблонами)
   - [Создание шаблона](#создание-шаблона)
   - [Переменные в шаблонах](#переменные-в-шаблонах)
   - [Предварительный просмотр](#предварительный-просмотр)
   - [Сохранение и загрузка шаблонов](#сохранение-и-загрузка-шаблонов)
6. [Отправка сообщений](#отправка-сообщений)
   - [Тестовое сообщение](#тестовое-сообщение)
   - [Массовая рассылка](#массовая-рассылка)
   - [Работа с медиафайлами](#работа-с-медиафайлами)
   - [Настройка интервалов](#настройка-интервалов)
   - [Остановка рассылки](#остановка-рассылки)
7. [Логи и отчеты](#логи-и-отчеты)
   - [Просмотр журнала](#просмотр-журнала)
   - [Фильтрация логов](#фильтрация-логов)
   - [Генерация отчетов](#генерация-отчетов)
   - [Экспорт логов](#экспорт-логов)
8. [Настройки](#настройки)
   - [Параметры рассылки](#параметры-рассылки)
   - [Пути к директориям](#пути-к-директориям)
   - [Параметры логирования](#параметры-логирования)
   - [Экспорт и импорт настроек](#экспорт-и-импорт-настроек)
9. [Советы и рекомендации](#советы-и-рекомендации)
   - [Предотвращение блокировок](#предотвращение-блокировок)
   - [Оптимальные настройки](#оптимальные-настройки)
   - [Частые проблемы и их решения](#частые-проблемы-и-их-решения)
10. [Технические детали](#технические-детали)
    - [Как работает отправка](#как-работает-отправка)
    - [Персонализация сообщений](#персонализация-сообщений)
    - [Форматирование номеров](#форматирование-номеров)

## Введение

Система рассылки iMessage — это программное обеспечение для автоматизированной отправки сообщений через iMessage на операционной системе macOS. Она позволяет загружать списки контактов из различных форматов файлов, создавать шаблоны сообщений с переменными для персонализации, отправлять как одиночные, так и массовые сообщения, а также контролировать процесс отправки с подробным логированием.

Основные возможности системы:
- Загрузка контактов из CSV, Excel и TXT файлов
- Создание шаблонов сообщений с поддержкой переменных
- Отправка персонализированных сообщений с медиафайлами
- Настраиваемые интервалы между сообщениями для предотвращения блокировок
- Детальное логирование и генерация отчетов
- Удобный графический интерфейс

## Установка

### Системные требования

- macOS 12.0 (Monterey) или новее
- Python 3.7 или новее
- Messages.app с настроенным iMessage
- Подключение к интернету

### Автоматическая установка

1. Скачайте и распакуйте архив с программой в удобное место на вашем компьютере.
2. Откройте Terminal (Терминал) и перейдите в распакованную директорию:
   ```bash
   cd /путь/к/директории/imessage_sender
   ```
3. Запустите установочный скрипт:
   ```bash
   python3 setup.py
   ```
4. Следуйте инструкциям на экране.
5. После завершения установки на рабочем столе появится ярлык для запуска программы.

### Ручная установка

1. Скачайте и распакуйте архив с программой.
2. Откройте Terminal и перейдите в распакованную директорию.
3. Установите необходимые зависимости:
   ```bash
   pip3 install -r requirements.txt
   ```
4. Создайте необходимые директории:
   ```bash
   mkdir -p logs templates reports
   ```
5. Запустите приложение:
   ```bash
   python3 gui.py
   ```

## Начало работы

### Запуск приложения

После установки вы можете запустить приложение одним из следующих способов:

1. Двойным кликом по ярлыку на рабочем столе (если вы использовали автоматическую установку).
2. Через Terminal:
   ```bash
   cd /путь/к/директории/imessage_sender
   python3 gui.py
   ```

### Обзор интерфейса

Интерфейс приложения разделен на несколько вкладок:

- **Контакты** — управление списками контактов
- **Шаблоны** — создание и редактирование шаблонов сообщений
- **Отправка** — настройка и запуск рассылки
- **Логи и отчеты** — просмотр журнала событий и работа с отчетами
- **Настройки** — конфигурация параметров системы

Сверху расположена панель инструментов с кнопками быстрого доступа к основным функциям.

## Работа с контактами

### Загрузка контактов

Для загрузки контактов:

1. Перейдите на вкладку **Контакты**.
2. Нажмите кнопку **Загрузить контакты**.
3. В открывшемся диалоговом окне выберите файл с контактами (CSV, Excel или TXT).
4. Нажмите **Открыть**.
5. После успешной загрузки контакты отобразятся в таблице и будет показано их количество.

### Форматы файлов контактов

Система поддерживает следующие форматы файлов:

#### CSV-файлы
```csv
phone,name,company
+79161234567,Иван Иванов,ООО Компания
+79162345678,Мария Петрова,ИП Сидоров
+79163456789,Петр Николаев,ЗАО Инновации
```

#### Excel-файлы
Excel-файлы должны содержать столбец с номерами телефонов. Система автоматически определит столбец с телефонами по его названию (phone, телефон, мобильный, mobile, номер).

#### TXT-файлы
Текстовые файлы должны содержать по одному номеру телефона в каждой строке:
```
+79161234567
+79162345678
+79163456789
```

### Поиск и фильтрация контактов

Для поиска контактов введите текст в поле **Поиск контактов**. Система будет фильтровать контакты по всем полям (телефон, имя, дополнительная информация) в режиме реального времени.

### Экспорт контактов

Для экспорта контактов:

1. Нажмите кнопку **Экспортировать контакты**.
2. В открывшемся диалоговом окне выберите место сохранения и имя файла.
3. Нажмите **Сохранить**.

Контакты будут экспортированы в формате CSV.

## Работа с шаблонами

### Создание шаблона

Для создания нового шаблона:

1. Перейдите на вкладку **Шаблоны**.
2. Нажмите кнопку **Новый**.
3. Введите имя шаблона в появившемся диалоговом окне.
4. Введите текст шаблона в текстовом редакторе.
5. При необходимости используйте переменные в формате `{{ имя_переменной }}`.
6. Нажмите кнопку **Сохранить** для сохранения шаблона.

### Переменные в шаблонах

Система поддерживает следующие типы переменных:

#### Основные переменные
- `{{ name }}` — имя получателя
- `{{ phone }}` — номер телефона
- `{{ company }}` — название компании
- И другие поля из файла контактов

#### Системные переменные
- `{{ date }}` — текущая дата
- `{{ time }}` — текущее время
- `{{ datetime }}` — дата и время
- `{{ year }}` — текущий год
- `{{ month }}` — текущий месяц
- `{{ day }}` — текущий день

### Предварительный просмотр

Для предварительного просмотра шаблона:

1. Введите тестовые значения переменных в поля в разделе **Предпросмотр**.
2. Нажмите кнопку **Предпросмотр**.
3. В области предпросмотра отобразится сообщение с подставленными значениями переменных.

### Сохранение и загрузка шаблонов

#### Сохранение шаблона в файл
1. Нажмите кнопку **Сохранить**.
2. В открывшемся диалоговом окне выберите место сохранения и имя файла.
3. Нажмите **Сохранить**.

#### Загрузка шаблона из файла
1. Нажмите кнопку **Загрузить**.
2. В открывшемся диалоговом окне выберите файл шаблона.
3. Нажмите **Открыть**.

## Отправка сообщений

### Тестовое сообщение

Для отправки тестового сообщения:

1. Перейдите на вкладку **Отправка**.
2. Нажмите кнопку **Выбрать контакты...** и выберите контакты на вкладке Контакты.
3. Нажмите кнопку **Выбрать шаблон...** и выберите шаблон на вкладке Шаблоны.
4. При необходимости добавьте медиафайл.
5. Нажмите кнопку **Тестовое сообщение**.
6. Сообщение будет отправлено первому контакту из списка.

### Массовая рассылка

Для запуска массовой рассылки:

1. Перейдите на вкладку **Отправка**.
2. Нажмите кнопку **Выбрать контакты...** и выберите контакты.
3. Нажмите кнопку **Выбрать шаблон...** и выберите шаблон.
4. При необходимости добавьте медиафайл.
5. Установите минимальный и максимальный интервалы между отправками сообщений.
6. Нажмите кнопку **Начать рассылку**.
7. Подтвердите начало рассылки в появившемся диалоговом окне.
8. Следите за прогрессом отправки в прогресс-баре и журнале отправки.

### Работа с медиафайлами

Для добавления медиафайла к сообщению:

1. Нажмите кнопку **Выбрать медиафайл...**.
2. В открывшемся диалоговом окне выберите файл для отправки.
3. Нажмите **Открыть**.

Поддерживаемые типы медиафайлов:
- Изображения: JPG, JPEG, PNG, GIF
- Видео: MP4, MOV
- Документы: PDF, DOC, DOCX, TXT

Для удаления медиафайла нажмите кнопку **Очистить**.

### Настройка интервалов

В разделе **Настройки рассылки** вы можете настроить интервалы между отправками сообщений:

- **Минимальный интервал (сек)** — минимальное время задержки между отправками.
- **Максимальный интервал (сек)** — максимальное время задержки между отправками.

Система будет выбирать случайное значение между минимальным и максимальным интервалами для каждого сообщения, что делает рассылку более естественной и снижает риск блокировки.

### Остановка рассылки

Для остановки запущенной рассылки:

1. Нажмите кнопку **Остановить**.
2. Подтвердите остановку в появившемся диалоговом окне.

Рассылка будет остановлена, и вы увидите статистику по уже отправленным сообщениям.

## Логи и отчеты

### Просмотр журнала

Для просмотра журнала событий:

1. Перейдите на вкладку **Логи и отчеты**.
2. В верхней части вкладки отображается журнал событий.
3. Для обновления журнала нажмите кнопку **Обновить**.

### Фильтрация логов

Для фильтрации журнала событий:

1. Выберите уровень логирования в выпадающем списке **Уровень**.
2. Введите текст для поиска в поле **Поиск**.
3. Журнал будет автоматически отфильтрован по указанным критериям.

### Генерация отчетов

Для создания отчета о рассылке:

1. Нажмите кнопку **Создать отчет**.
2. Выберите формат отчета (TXT, HTML, JSON) в появившемся диалоговом окне.
3. Нажмите **ОК**.
4. После создания отчет автоматически откроется для просмотра.
5. Отчет будет добавлен в список отчетов в нижней части вкладки.

### Экспорт логов

Для экспорта журнала событий:

1. Нажмите кнопку **Экспорт журнала**.
2. В открывшемся диалоговом окне выберите место сохранения и имя файла.
3. Выберите формат файла (TXT, HTML, CSV, JSON).
4. Нажмите **Сохранить**.

## Настройки

### Параметры рассылки

На вкладке **Настройки** вы можете настроить следующие параметры рассылки:

- **Минимальная задержка (сек)** — минимальное время между отправками сообщений.
- **Максимальная задержка (сек)** — максимальное время между отправками сообщений.
- **Размер пакета** — количество сообщений в одном пакете для обработки.
- **Использовать AppleScript** — метод отправки сообщений через AppleScript.

### Пути к директориям

В разделе **Настройки путей** вы можете указать пути к следующим директориям:

- **Директория логов** — путь для сохранения файлов логов.
- **Директория шаблонов** — путь для сохранения файлов шаблонов.
- **Директория отчетов** — путь для сохранения файлов отчетов.

### Параметры логирования

В разделе **Настройки логирования** вы можете настроить следующие параметры:

- **Уровень логирования** — детализация записей в логе (debug, info, warning, error, critical).
- **Вывод в консоль** — дублирование логов в консоль.

### Экспорт и импорт настроек

#### Экспорт настроек
1. Нажмите кнопку **Экспорт настроек**.
2. В открывшемся диалоговом окне выберите место сохранения и имя файла.
3. Нажмите **Сохранить**.

#### Импорт настроек
1. Нажмите кнопку **Импорт настроек**.
2. В открывшемся диалоговом окне выберите файл настроек.
3. Нажмите **Открыть**.
4. Настройки будут загружены и применены.

## Советы и рекомендации

### Предотвращение блокировок

Чтобы избежать блокировки аккаунта iMessage при массовой рассылке, следуйте этим рекомендациям:

1. **Используйте достаточные интервалы между отправками**
   - Рекомендуемый минимальный интервал: 5-7 секунд
   - Рекомендуемый максимальный интервал: 10-15 секунд

2. **Ограничьте количество сообщений в одной рассылке**
   - Рекомендуемое количество: не более 100 сообщений за один сеанс
   - Делайте перерывы между большими рассылками (30-60 минут)

3. **Персонализируйте сообщения**
   - Используйте разные шаблоны для разных групп контактов
   - Включайте персональные данные (имя, компания и т.д.)
   - Избегайте отправки одинаковых сообщений большому количеству получателей

4. **Избегайте подозрительных паттернов**
   - Не отправляйте одни и те же ссылки в сообщениях
   - Не используйте слишком много заглавных букв и восклицательных знаков
   - Избегайте частого использования слов, ассоциирующихся со спамом

### Оптимальные настройки

Для оптимальной работы системы рекомендуются следующие настройки:

- **Минимальная задержка:** 5-7 секунд
- **Максимальная задержка:** 10-15 секунд
- **Размер пакета:** 50
- **Уровень логирования:** info (для обычного использования) или debug (для поиска проблем)
- **Вывод в консоль:** включен

### Частые проблемы и их решения

1. **Сообщения не отправляются**
   - Убедитесь, что iMessage правильно настроен на вашем Mac
   - Проверьте интернет-соединение
   - Проверьте, активирован ли ваш Apple ID
   - Перезапустите Messages.app

2. **Ошибки при загрузке контактов**
   - Проверьте формат файла
   - Убедитесь, что файл содержит столбец с номерами телефонов
   - Проверьте кодировку файла (рекомендуется UTF-8)

3. **Медленная отправка сообщений**
   - Уменьшите размер медиафайлов
   - Увеличьте размер пакета в настройках
   - Проверьте скорость интернет-соединения

4. **Аккаунт временно заблокирован**
   - Немедленно прекратите отправку сообщений
   - Подождите 24-48 часов
   - В будущем используйте более консервативные настройки интервалов
   - Разбивайте большие рассылки на несколько меньших

## Технические детали

### Как работает отправка

Система использует AppleScript для взаимодействия с приложением Messages.app на macOS. Это позволяет отправлять сообщения через официальное приложение Apple, что обеспечивает надежность и минимизирует риск блокировки.

```applescript
tell application "Messages"
    set targetService to 1st service whose service type = iMessage
    set targetBuddy to buddy "{phone_number}" of targetService
    send "{message}" to targetBuddy
end tell
```

### Персонализация сообщений

Персонализация сообщений осуществляется путем замены переменных в шаблоне на соответствующие значения из контакта или системные значения. Система использует простой шаблонизатор с поддержкой переменных в формате `{{ имя_переменной }}`.

Пример:
```
Шаблон: Здравствуйте, {{ name }}! Напоминаем о {{ event }} {{ date }}.
Контакт: {"name": "Иван", "event": "встрече"}
Результат: Здравствуйте, Иван! Напоминаем о встрече 03.04.2025.
```

### Форматирование номеров

Система автоматически форматирует номера телефонов для совместимости с iMessage. Поддерживаются следующие форматы ввода:

- Международный формат с +: `+79161234567`
- Без +: `79161234567`
- С пробелами и скобками: `+7 (916) 123-45-67`
- С дефисами: `7-916-123-45-67`

Все номера приводятся к единому формату для отправки через iMessage.

---

© 2025, Михаил
