# features/admin/schedule-management.feature

Функционал: Управление сеткой расписания
  Как супервайзер WFM
  Я хочу управлять расписаниями сотрудников в виде сетки
  Чтобы эффективно назначать смены более чем 500 сотрудникам

  Предыстория:
    Дано я вошёл в систему как супервайзер
    И выбран контакт-центр "Контакт-центр 1010"
    И я перехожу в раздел управления расписанием

  Сценарий: Просмотр расписания на месяц
    Дано в системе есть более 500 сотрудников
    Когда я выбираю диапазон дат "01.07.2024" - "31.07.2024"
    Тогда я вижу виртуализированную сетку со списком всех сотрудников вертикально
    И я вижу даты за июль 2024 по горизонтали
    И каждая ячейка показывает текущую назначенную смену либо пустая
    И выходные (суббота/воскресенье) выделены жирным
    И текущий день "17.07" подсвечен цветом контекста

  Сценарий: Фильтр сотрудников по навыкам
    Дано я просматриваю сетку расписания
    Когда я нажимаю на выпадающий список навыков
    И выбираю навык "Входящая линия_1"
    Тогда отображаются только сотрудники с выбранным навыком
    И фильтр навыков показывает цветной индикатор для "Входящая линия_1"
    И общее количество сотрудников обновляется

  Сценарий: Поиск сотрудников по фамилии
    Дано я просматриваю сетку расписания
    Когда я ввожу "Абдуллаева" в поле поиска сотрудников
    Тогда отображаются только сотрудники с фамилией "Абдуллаева"
    И результаты поиска подсвечиваются
    И я могу нажать на выпадающий список для выбора подсказки

  Сценарий: Выбрать всех сотрудников
    Дано я просматриваю сетку расписания
    Когда я нажимаю чекбокс "Все" в заголовке
    Тогда все видимые сотрудники выделяются
    И чекбоксы сотрудников отмечены
    И становятся доступны массовые действия

  Сценарий: Переключение между периодами
    Дано я просматриваю расписание за июль 2024
    Когда я изменяю дату начала на "01.08.2024"
    И изменяю дату окончания на "31.08.2024"
    И нажимаю кнопку обновления
    Тогда таблица обновляется и показывает август 2024
    И номера недель обновляются (неделя 31, 32 и т.д.)

  Сценарий: Просмотр графиков прогноза и плана
    Дано я просматриваю сетку расписания
    Когда я смотрю на панель графиков над таблицей
    Тогда активен режим "Прогноз + план"
    И график показывает прогнозные данные за выбранный период
    И элементы управления содержат опции "Отклонения" и "Уровень сервиса (SL)"

  Сценарий: Пересчёт показателя FTE
    Дано данные расписания загружены
    Когда я нажимаю кнопку пересчёта "FTE"
    Тогда система пересчитывает эквивалент полной занятости
    И значения FTE обновляются в таблице
    И при необходимости я могу просмотреть сумму FTE

  Сценарий: Автоматическое построение расписания
    Дано я просматриваю сетку расписания
    Когда я нажимаю кнопку "Построить"
    Тогда система автоматически генерирует назначения смен
    И таблица обновляется новыми сменами
    И я вижу сообщение об успешной операции

  Сценарий: Публикация изменений расписания
    Дано я внес изменения в расписание
    Когда кнопка публикации показывает "Есть неопубликованные изменения"
    И я нажимаю кнопку публикации
    Тогда изменения публикуются для сотрудников
    И статус публикации обновляется
    И сотрудники видят новое расписание

  Сценарий: Импортировать активности из Excel
    Дано я просматриваю сетку расписания
    Когда я нажимаю кнопку импорта
    И выбираю файл Excel с данными активностей
    Тогда данные импортируются в систему
    И сетка расписания обновляется импортированными данными

  @performance
  Сценарий: Обработка больших наборов сотрудников
    Дано в контакт-центре более 500 сотрудников
    Когда я открываю сетку расписания
    Тогда виртуализированная таблица загружается эффективно
    И прокрутка сотрудников происходит плавно
    И интерфейс остается отзывчивым при операциях

  @realtime @collaboration
  Сценарий: Одновременное редактирование расписания с разрешением конфликтов
    Дано пользователь "Админ1" редактирует расписание смены
    И пользователь "Админ2" одновременно открывает ту же смену
    Когда "Админ1" изменяет время смены на "09:00-17:00"
    И "Админ2" изменяет время той же смены на "10:00-18:00"
    Тогда система показывает предупреждение о конфликте
    И предлагает варианты разрешения конфликта

  @realtime
  Сценарий: Отслеживание курсора в реальном времени при перетаскивании
    Дано два администратора редактируют расписание одновременно
    Когда один администратор перетаскивает смену на новую ячейку
    Тогда второй администратор видит его курсор в реальном времени
    И ячейка подсвечивается пока действие не завершено

  @realtime
  Сценарий: Индикатор редактирования виден другим пользователям
    Дано администратор начал изменять ячейку расписания
    Когда другой пользователь открывает тот же график
    Тогда он видит значок о том, что ячейка редактируется

  @realtime
  Сценарий: Автосохранение обнаруживает конфликт ручного сохранения
    Дано пользователь сохраняет изменения автоматически
    И другой пользователь пытается сохранить ту же ячейку вручную
    Тогда система сообщает о несохранённых изменениях
    И предлагает перезагрузить данные

  @realtime
  Сценарий: Переподключение после временной потери сети
    Дано веб-сокет соединение оборвалось во время редактирования
    Когда связь восстанавливается
    Тогда система автоматически переподключается
    И непрерывность редактирования сохраняется

  @realtime
  Сценарий: Завершение редактирования очищает индикаторы
    Дано пользователь завершает редактирование ячейки
    Когда он покидает страницу расписания
    Тогда индикаторы совместного редактирования исчезают для остальных

  @realtime
  Сценарий: Обновление расписания в реальном времени после перетаскивания
    Дано пользователь перемещает смену на другой день
    Когда операция подтверждена
    Тогда другие пользователи сразу видят новое расположение смены

  @realtime
  Сценарий: Живое обновление наложения прогноза через WebSocket
    Дано открыта панель "Прогноз + план"
    Когда сервер отправляет новые прогнозные данные
    Тогда график обновляется без перезагрузки страницы

  @realtime @collaboration
  Сценарий: Совместное применение шаблонов между пользователями
    Дано два администратора выделили разные группы сотрудников
    Когда первый применяет шаблон смен к своей группе
    Тогда второй видит изменение мгновенно
    И покрытие обновляется у обоих пользователей

  @realtime @collaboration
  Сценарий: Координация массовых операций несколькими пользователями
    Дано несколько администраторов выбрали набор смен
    Когда один из них выполняет массовое изменение
    Тогда остальные получают уведомление о завершении операции
    И их таблица обновляется автоматически

  @performance @virtualization @benchmark
  Сценарий: Виртуальная прокрутка поддерживает 60fps с 1000+ сотрудниками
    Дано открыто расписание с "1000 сотрудниками"
    И каждый сотрудник имеет данные за "3 месяца"
    Когда выполняется быстрая прокрутка вертикально
    Тогда частота кадров остается выше "55 FPS"
    И время отклика интерфейса менее "16ms"
    И память не увеличивается более чем на "50MB"

  @performance @loading
  Сценарий: Ленивая загрузка групп сотрудников через Intersection Observer
    Дано я нахожусь на расписании с 1000+ сотрудниками
    Когда прокручиваю список до конца видимой области
    Тогда следующая партия сотрудников загружается лениво
    И сетка остается отзывчивой без скачков прокрутки

  @performance
  Сценарий: Сетка расписания очищается после размонтирования
    Дано я открываю и закрываю страницу расписания
    Когда компонент расписания размонтируется
    Тогда все обработчики событий удаляются
    И использование памяти возвращается к начальному уровню

  @performance
  Сценарий: Размер бандла не превышает 250КБ после сборки
    Дано разработчик собирает модуль расписания
    Когда выполняется анализ размера бандла
    Тогда итоговый размер JavaScript не превышает "250KB"
    И отчет по оптимизации сохраняется

  @realtime @performance
  Сценарий: Пропускная способность WebSocket — 200 обновлений в минуту
    Дано открыто расписание с активным веб-сокет соединением
    Когда система получает 200 обновлений за минуту
    Тогда пакетные обновления применяются без задержек
    И интерфейс не теряет плавность

  @realtime @performance
  Сценарий: Длительная сессия редактирования не приводит к утечке памяти
    Дано администратор редактирует расписание более "2 часов"
    Когда веб-сокет соединение постоянно обновляет данные
    Тогда использование памяти стабильно
    И производительность интерфейса не ухудшается

  @performance @virtualization
  Сценарий: Эффективное использование памяти с большими данными
    Дано открыто расписание с "1000 сотрудниками"
    Когда система загружает данные за "месяц"
    Тогда используется виртуализация для отображения
    И память не превышает "300MB"
    И прокрутка остается плавной

  @virtualization
  Сценарий: Ленивая подгрузка строк сотрудников при прокрутке
    Дано я нахожусь в начале списка сотрудников
    Когда прокручиваю таблицу вниз
    Тогда новые строки подгружаются по мере прокрутки
    И индикатор загрузки отображается кратковременно

  @virtualization
  Сценарий: Оптимизация отрисовки ячеек сетки
    Дано я открываю расписание с несколькими видами смен
    Когда я быстро перемещаюсь между днями
    Тогда ячейки перестраиваются без мерцаний
    И количество перерисовок минимально

  @mobile
  Сценарий: Адаптивная сетка расписания на мобильных устройствах
    Дано я использую мобильный браузер
    Когда открываю страницу расписания
    Тогда таблица адаптируется под ширину экрана
    И элементы управления остаются доступными
