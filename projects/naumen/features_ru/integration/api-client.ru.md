# features/integration/api-client.feature

Функционал: Централизованный API-клиент
  Как разработчик
  Я хочу единообразно обрабатывать запросы к API
  Чтобы все модули надёжно взаимодействовали с сервером

  Предыстория:
    Дано базовый URL API задан в настройках окружения
    И клиент axios инициализирован с интерцепторами

  @api @integration
  Сценарий: Добавление токена авторизации к каждому запросу
    Дано пользователь вошёл в систему и имеет токен "demo-token"
    Когда отправляется GET запрос на "/employees"
    Тогда заголовок Authorization содержит "Bearer demo-token"

  @api
  Сценарий: Глобальное преобразование данных ответа
    Дано сервер возвращает поле "data" в ответе
    Когда клиент получает ответ
    Тогда данные извлекаются из обёртки и передаются модулю

  @api @error-handling
  Сценарий: Повтор запроса после сетевой ошибки
    Дано сеть временно недоступна при выполнении запроса
    Когда клиент получает сообщение об ошибке сети
    Тогда выполняется повторная попытка через 3 секунды
    И при успехе данные возвращаются модулю

  @api
  Сценарий: Отслеживание прогресса загрузки файла
    Дано пользователь загружает файл размером 10MB
    Когда выполняется POST запрос с multipart/form-data
    Тогда клиент показывает процент выполнения до 100%
    И по завершении отображается сообщение об успешной загрузке

  @api
  Сценарий: Управление версией API через префикс
    Дано текущая версия API "v1"
    Когда отправляется запрос на эндпоинт "/v1/reports"
    Тогда сервер обрабатывает запрос согласно версии

  @api @error-handling
  Сценарий: Глобальная обработка ответа 401
    Дано токен пользователя недействителен
    Когда сервер возвращает статус 401
    Тогда клиент выполняет выход пользователя
    И происходит перенаправление на страницу входа

  @api
  Сценарий: Уведомление о лимитах запросов
    Дано сервер отвечает кодом 429 и заголовком "retry-after"
    Когда клиент получает такой ответ
    Тогда пользователь видит предупреждение об ограничении
    И запрос повторяется после указанного времени
