# features/integration/cross-module-auth.feature

Функционал: Единая аутентификация между модулями
  Как авторизованный пользователь
  Я хочу входить один раз во все модули WFM
  Чтобы не выполнять повторный вход

  Предыстория:
    Дано пользователь аутентифицирован в интеграционном портале
    И действительный токен сохранён в локальном хранилище

  @integration @authentication
  Сценарий: Передача токена во встроенный iframe
    Когда модуль "Прогнозы" загружается в iframe
    Тогда токен передаётся в параметры запроса
    И модуль открывается без дополнительного входа

  @integration @roles
  Сценарий: Ограничение доступа к неразрешённому модулю
    Дано пользователь имеет роль "manager"
    Когда он пытается открыть модуль "Прогнозирование нагрузки"
    Тогда доступ запрещён
    И отображается уведомление о недостаточных правах

  @integration
  Сценарий: Общий тайм-аут сессии между модулями
    Дано сессия пользователя истекает через 5 минут
    Когда таймер обновления запускается в главном приложении
    Тогда таймер в iframe синхронизируется
    И оба модуля выходят одновременно

  @integration @error-handling
  Сценарий: Ошибка аутентификации во встроенном модуле
    Дано токен пользователя просрочен
    Когда iframe модуля сообщает об ошибке 401
    Тогда пользователь перенаправляется на страницу входа
    И все модули закрываются

  @integration
  Сценарий: Вход из iframe использует глобальную сессию
    Дано пользователь не авторизован в главном приложении
    Когда он открывает iframe модуля и проходит форму входа
    Тогда оболочка получает событие успешной аутентификации
    И пользователь считается вошедшим во всех модулях

  @integration
  Сценарий: Синхронный выход из всех модулей
    Дано пользователь открыт в нескольких модулях
    Когда он выходит из системы в одном модуле
    Тогда остальные модули автоматически завершают сессию
