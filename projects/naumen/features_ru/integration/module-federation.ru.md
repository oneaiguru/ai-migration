# features/integration/module-federation.feature

Функционал: Архитектура модульной федерации
  Как системный администратор
  Я хочу чтобы модули бесшовно интегрировались
  Чтобы пользователи получали единый опыт работы с WFM

  Предыстория:
    Дано все модули WFM запущены на своих портах
    И я вошёл в интеграционный портал как администратор

  @integration @modules
  Сценарий: Загрузка модуля расписания в iframe
    Дано пользователь авторизован в главном приложении
    Когда переходит в модуль "Расписание" на порту "3004"
    Тогда модуль загружается в iframe без ошибок
    И отображается индикатор загрузки
    И навигация синхронизируется с главным приложением

  @integration @error-handling
  Сценарий: Обработка ошибки загрузки модуля
    Дано модуль "Отчёты" на порту "3010" недоступен
    Когда пользователь пытается открыть модуль
    Тогда отображается сообщение об ошибке загрузки
    И предлагается повторить попытку
    И пользователь остаётся в главном приложении

  @integration
  Сценарий: Обнаружение конфликта порта при запуске
    Дано порт "3002" уже занят другим процессом
    Когда система запускает модуль "Прогнозы"
    Тогда отображается предупреждение о конфликте порта
    И модуль не запускается до устранения проблемы

  @integration
  Сценарий: Сохранение состояния навигации между модулями
    Дано пользователь находится в разделе "Планирование смен"
    Когда он открывает модуль "Управление персоналом" в новом iframe
    Тогда состояние бокового меню сохраняется
    И текущая вкладка выделена в обоих модулях

  @integration
  Сценарий: Мониторинг состояния модулей
    Дано модули работают на портах 3002, 3004, 3010 и 3018
    Когда выполняется проверка состояния модулей
    Тогда система отображает статус каждого модуля как "online" или "offline"
    И при ошибке предлагается перезапустить модуль

  @integration
  Сценарий: Обмен сообщениями между хостом и модулем
    Дано модуль "Управление персоналом" открыт в iframe
    Когда хост отправляет сообщение "refresh-data" через postMessage
    Тогда модуль получает команду и перезагружает данные
    И модуль отвечает сообщением "refresh-complete"

  @integration
  Сценарий: Одновременное открытие нескольких модулей
    Дано пользователь открыл модули "Расписание" и "Прогнозы" в отдельных вкладках
    Когда он переключается между вкладками
    Тогда каждый модуль сохраняет свою внутреннюю навигацию
    И глобальный статус соединения отображается для каждого модуля
