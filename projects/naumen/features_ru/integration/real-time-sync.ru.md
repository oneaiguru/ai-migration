# features/integration/real-time-sync.feature

Функционал: Синхронизация в реальном времени
  Как пользователь системы совместной работы
  Я хочу чтобы модули синхронизировались через WebSocket
  Чтобы обновления появлялись мгновенно во всей системе

  Предыстория:
    Дано пользователь вошёл в систему и WebSocket соединение установлено

  @realtime @integration
  Сценарий: Рассылка обновления расписания другим модулям
    Дано администратор изменяет расписание сотрудника
    Когда событие "schedule:updated" отправляется сервером
    Тогда модуль "Прогнозы" получает обновлённые данные
    И отображает уведомление об изменении

  @realtime
  Сценарий: Восстановление соединения после сбоя сети
    Дано соединение WebSocket прервано
    Когда клиент выполняет 5 попыток переподключения
    Тогда после успешного подключения состояние восстанавливается
    И недоставленные события обрабатываются

  @realtime
  Сценарий: Доставка уведомления между модулями
    Дано модуль "Отчеты" отправляет уведомление о готовности отчёта
    Когда сообщение типа "notification:new" поступает через WebSocket
    Тогда пользователь видит уведомление в интеграционном портале
    И iframe модуля получает ту же информацию

  @realtime
  Сценарий: Синхронизация индикаторов редактирования
    Дано два администратора редактируют один график
    Когда модуль отправляет событие "schedule:edit:start"
    Тогда другие пользователи видят индикатор совместного редактирования
    И при событии "schedule:edit:end" индикатор исчезает

  @realtime
  Сценарий: Показ индикатора состояния соединения
    Дано пользователь находится на панели управления
    Когда WebSocket соединение переходит в состояние "connecting"
    Тогда в верхней панели отображается жёлтый индикатор
    И при успешном подключении он становится зелёным

  @realtime
  Сценарий: Начальное рукопожатие при входе
    Дано пользователь вошёл в систему
    Когда устанавливается WebSocket соединение
    Тогда клиент отправляет событие "handshake" с идентификатором пользователя
    И сервер подтверждает подключение
