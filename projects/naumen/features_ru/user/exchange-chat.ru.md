# features/user/exchange-chat.feature

Функционал: Чат обмена сменами в реальном времени
  Как сотрудник
  Я хочу переписываться с коллегами при обмене сменами
  Чтобы быстро согласовывать детали

  Предыстория:
    Дано я вошёл в систему управления персоналом
    И у меня есть права сотрудника
    И я инициировал обмен сменой с коллегой

  @chat @realtime
  Сценарий: Открыть чат из заявки на обмен
    Когда я открываю чат по выбранной смене
    Тогда появляется окно чата в реальном времени
    И загружается предыдущая переписка

  @chat @realtime
  Сценарий: Отправить текстовое сообщение
    Дано чат обмена открыт
    Когда я ввожу сообщение и нажимаю отправить
    Тогда моё сообщение моментально доставляется
    И коллега получает уведомление

  @chat
  Сценарий: Отправить предложение смены
    Дано я хочу оформить обмен
    Когда я отправляю предложение смены в чате
    Тогда карточка предложения содержит дату, время и место
    И коллега может принять или отклонить его

  @chat @realtime
  Сценарий: Индикатор набора сообщения
    Когда коллега печатает ответ
    Тогда я вижу индикатор набора в окне чата

  @chat @notification
  Сценарий: История сообщений после закрытия
    Дано я переписывался с коллегой
    Когда позже снова открываю чат обмена
    Тогда отображается история переписки
    И непрочитанные сообщения отмечены

  @interaction @ux
  Сценарий: Отправка предустановленного сообщения
    Дано чат обмена открыт
    Когда я выбираю шаблон "Согласен на обмен"
    Тогда текст подставляется в поле ввода
    И после Enter сообщение отправляется
    И собеседник видит его мгновенно

  @interaction @ux
  Сценарий: Автопрокрутка к новому сообщению
    Дано в чате много сообщений
    Когда приходит новое сообщение от коллеги
    Тогда список автоматически прокручивается к последнему сообщению

  @interaction @ux
  Сценарий: Фокус остаётся в поле ввода после отправки
    Дано я набираю текст
    Когда нажимаю Enter для отправки
    Тогда сообщение отправляется
    И курсор остаётся в поле ввода

  @interaction @ux @mobile
  Сценарий: Закрытие чата свайпом на мобильном
    Дано чат обмена открыт на мобильном устройстве
    Когда я делаю жест свайпа вниз
    Тогда окно чата закрывается
    И список предложений снова виден

  @interaction @context
  Сценарий: Цитирование нескольких сообщений через меню
    Дано я выделяю несколько сообщений
    Когда вызываю контекстное меню и выбираю "Цитировать"
    Тогда выбранные сообщения добавляются в поле ввода как цитаты
