# features/admin/forecast-building.feature

Функционал: Построение прогноза
  Как менеджер по персоналу
  Я хочу создавать различные типы прогнозов
  Чтобы предсказывать потребность в персонале

  Предыстория:
    Дано я вошёл в систему управления персоналом
    И имею доступ к данным контакт-центра

  Сценарий: Создание нового прогноза
    Дано я нахожусь на странице "Построить прогноз"
    Когда я настраиваю параметры прогноза
    И выбираю период и необходимые навыки
    И нажимаю "Построить прогноз"
    Тогда система генерирует новый прогноз
    И я вижу результаты расчёта

  Сценарий: Настройка исключений для прогноза
    Дано я нахожусь на странице "Задать исключения"
    Когда я настраиваю правила исключений
    И сохраняю настройки
    Тогда исключения применяются к будущим прогнозам

  Сценарий: Анализ трендов
    Дано я нахожусь на странице "Анализ трендов"
    Когда я выбираю период для анализа
    И выбираю метрики
    Тогда отображаются результаты анализа трендов
    И я могу выявлять паттерны и аномалии

  Сценарий: Подменю модуля "Прогнозы"
    Дано я нахожусь в модуле "Прогнозы"
    Тогда я вижу следующие пункты подменю:
      | Построить прогноз |
      | Задать исключения |
      | Анализ трендов |
      | Расчёт абсентеизма |
    И текущая активная страница подсвечена

  @analytics @accuracy
  Сценарий: Расчёт MAPE для проверки точности
    Дано загружены исторические данные за "12 месяцев"
    И выполнен прогноз алгоритмом "ARIMA"
    Когда система вычисляет MAPE
    Тогда значение MAPE менее "15%"
    И отображается доверительный интервал "95%"
    И показываются детали расчёта

  @analytics @accuracy
  Сценарий: Проверка MAE
    Дано выполнен прогноз алгоритмом "Линейная регрессия"
    Когда система вычисляет MAE
    Тогда MAE менее "20"
    И выводятся рекомендации по улучшению точности

  @analytics @accuracy
  Сценарий: Вычисление RMSE
    Дано есть фактические данные за последний месяц
    Когда выполняется расчёт RMSE
    Тогда значение RMSE отображается на панели
    И показываются границы ошибки

  @analytics @accuracy
  Сценарий: Анализ коэффициента детерминации R-squared
    Дано выбраны предсказанные и фактические значения
    Когда система вычисляет R-squared
    Тогда коэффициент детерминации выше "0.8"
    И выводятся сведения о силе корреляции

  @analytics @accuracy
  Сценарий: Обнаружение и коррекция смещения прогноза
    Дано загружены данные прогноза и факта
    Когда система анализирует Bias
    Тогда отображается показатель Bias
    И предлагается автоматическая корректировка

  @analytics @comparison
  Сценарий: Сравнение нескольких алгоритмов
    Дано загружены данные с сезонными паттернами
    Когда выполняется сравнение алгоритмов "ARIMA, Linear Regression, Ensemble"
    Тогда система показывает метрики точности для каждого алгоритма
    И рекомендует наиболее подходящий
    И отображается статистическая значимость различий

  @analytics @validation
  Сценарий: Кросс-валидация модели
    Дано выполнен прогноз текущими настройками
    Когда запускается кросс-валидация на "5" фолдах
    Тогда система показывает метрики для каждой итерации
    И выводит среднее значение MAPE

  @analytics @statistics
  Сценарий: Проверка статистической значимости алгоритмов
    Дано имеются результаты нескольких алгоритмов
    Когда выполняется t-тест для сравнения MAPE
    Тогда выводится значение p-value
    И принимается решение о значимости

  @analytics
  Сценарий: Оптимизация параметров алгоритма
    Дано выбран алгоритм "ARIMA модель"
    Когда пользователь изменяет параметры и запускает оптимизацию
    Тогда система находит параметры с минимальным MAPE
    И сохраняет оптимизированную конфигурацию

  @analytics
  Сценарий: Создание ансамбля моделей
    Дано доступны результаты нескольких алгоритмов
    Когда пользователь создаёт ансамбль моделей
    Тогда система объединяет прогнозы в единый результат
    И отображает суммарную точность

  @analytics
  Сценарий: Интерактивная корректировка прогноза
    Дано открыт модуль "Корректировки прогноза"
    Когда аналитик изменяет значения интервалов
    Тогда изменения отображаются в таблице
    И рассчитываются обновлённые показатели

  @analytics
  Сценарий: Массовые операции корректировки
    Дано выбрано несколько интервалов прогноза
    Когда выполняется массовая корректировка на "10%"
    Тогда все интервалы изменяются с учётом операции
    И система проверяет допустимые границы

  @analytics
  Сценарий: История корректировок
    Дано выполнены изменения прогноза
    Когда пользователь открывает историю корректировок
    Тогда отображается список последних операций
    И можно просмотреть детали каждой корректировки

  @analytics
  Сценарий: Отмена и возврат корректировок
    Дано пользователь внёс несколько изменений
    Когда он нажимает "Отменить"
    Тогда последняя корректировка удаляется
    И при нажатии "Повторить" изменение возвращается

  @analytics
  Сценарий: Проверка ограничений корректировки
    Дано введена корректировка, превышающая допустимое значение
    Когда система проверяет ограничения
    Тогда выводится сообщение об ошибке
    И корректировка не применяется

  @analytics
  Сценарий: Учет экспертных замечаний
    Дано аналитик добавляет комментарий к прогнозу
    Когда комментарий сохраняется
    Тогда система учитывает замечания при дальнейших расчётах

  @analytics @ui
  Сценарий: Отображение графика временного ряда
    Дано построен прогноз за выбранный период
    Когда открывается график временного ряда
    Тогда отображаются линии "Факт" и "Прогноз"
    И показывается доверительный интервал

  @analytics @ui
  Сценарий: Наложение нескольких наборов данных
    Дано доступны данные требуемых агентов
    Когда пользователь включает слой "Требуется агентов"
    Тогда на графике отображаются все серии данных одновременно

  @analytics @ui
  Сценарий: Интерактивное управление графиком
    Дано открыт график прогноза
    Когда пользователь масштабирует область колесом мыши
    Тогда график увеличивается без потери качества
    И можно перемещать отображаемый диапазон

  @analytics @ui
  Сценарий: Экспорт графика
    Дано на экране отображается график прогноза
    Когда пользователь нажимает кнопку "Экспорт"
    Тогда изображение сохраняется в файл

  @analytics @ui
  Сценарий: Адаптивность графика
    Дано я открываю прогноз на мобильном устройстве
    Тогда график подстраивается под размер экрана
    И элементы управления остаются доступными

  @analytics @ui
  Сценарий: Обновление графика в реальном времени
    Дано включено автоматическое обновление
    Когда проходит заданный интервал
    Тогда график обновляется новыми данными без перезагрузки
