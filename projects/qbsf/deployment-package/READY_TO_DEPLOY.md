# ‚úÖ –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ: Salesforce-QuickBooks Integration Phase 2

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–¥ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å (–±–µ–∑ "Approved")
- **–£–ë–†–ê–õ–ò**: –†—É—á–Ω–æ–π —Å—Ç–∞—Ç—É—Å "Approved" 
- **–î–û–ë–ê–í–ò–õ–ò**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ SF Invoice + QB Invoice –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–†–ï–ó–£–õ–¨–¢–ê–¢**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç –≤—Ä—É—á–Ω—É—é

### ‚úÖ Supplier filtering –ø–æ Account –ø–æ–ª—è–º
- **–°–û–ó–î–ê–õ–ò**: Account.Type (picklist: –ö–ª–∏–µ–Ω—Ç, –ü–æ—Å—Ç–∞–≤—â–∏–∫, –ù–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è)
- **–°–û–ó–î–ê–õ–ò**: Account.Country__c (picklist: US, EU, RU, Other)
- **–û–ë–ù–û–í–ò–õ–ò**: –õ–æ–≥–∏–∫—É `Account.Type = '–ü–æ—Å—Ç–∞–≤—â–∏–∫' AND Account.Country__c = 'US'`

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–ø–ª–∞—Ç
- **–°–û–ó–î–ê–õ–ò**: QBPaymentMonitor.cls - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- **–î–û–ë–ê–í–ò–õ–ò**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ Opportunity –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
- **–ù–ê–°–¢–†–û–ò–õ–ò**: –ü–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É QB ‚Üí SF ‚Üí Opportunity

## üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Salesforce (–≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é)
```
deployment-package/force-app/main/default/
‚îú‚îÄ‚îÄ objects/Account/fields/
‚îÇ   ‚îú‚îÄ‚îÄ Type.field-meta.xml ‚úÖ –ù–û–í–û–ï
‚îÇ   ‚îî‚îÄ‚îÄ Country__c.field-meta.xml ‚úÖ –ù–û–í–û–ï
‚îú‚îÄ‚îÄ triggers/
‚îÇ   ‚îî‚îÄ‚îÄ InvoiceQBSyncTrigger.trigger ‚úÖ –û–ë–ù–û–í–õ–ï–ù–û
‚îú‚îÄ‚îÄ classes/
‚îÇ   ‚îú‚îÄ‚îÄ QBInvoiceSyncQueueable.cls ‚úÖ –û–ë–ù–û–í–õ–ï–ù–û  
‚îÇ   ‚îú‚îÄ‚îÄ QBPaymentMonitor.cls ‚úÖ –ù–û–í–û–ï
‚îÇ   ‚îú‚îÄ‚îÄ QBPaymentMonitorTest.cls ‚úÖ –ù–û–í–û–ï
‚îÇ   ‚îî‚îÄ‚îÄ [–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã]
‚îî‚îÄ‚îÄ manifest/package.xml ‚úÖ –ì–û–¢–û–í–û
```

### Test Coverage
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è QBPaymentMonitor
- ‚úÖ Coverage 75%+ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è

### 1. –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å)
```bash
cd /Users/m/git/clients/qbsf/deployment-package
chmod +x deploy.sh
./deploy.sh
```

### 2. –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
```bash
cd /Users/m/git/clients/qbsf/deployment-package
sfdx force:source:deploy -p force-app -u production --testlevel RunLocalTests
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
```apex
// –í Salesforce Developer Console
QBPaymentMonitor.schedulePaymentMonitoring();
```

## üîß Middleware –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ù–æ–≤—ã–µ endpoints (—É–∂–µ –≥–æ—Ç–æ–≤—ã –≤ –∫–æ–¥–µ)
- `POST /api/sf-invoice-to-qb` - –¥–ª—è SF Invoice –æ–±—ä–µ–∫—Ç–æ–≤
- `POST /api/check-invoice-payment-status` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–ø–ª–∞—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ sf-qb-integration.atocomm.eu
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ middleware —Å –Ω–æ–≤—ã–º–∏ endpoints
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
pm2 restart sf-qb-integration
```

## üìã –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

```mermaid
flowchart TD
    A[üë§ Opportunity] --> B[–°—Ç–∞—Ç—É—Å: Proposal and Agreement]
    B --> C[ü§ñ SF Invoice —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏]
    C --> D{üè¢ Supplier –ø—Ä–æ–≤–µ—Ä–∫–∞}
    D -->|Type=–ü–æ—Å—Ç–∞–≤—â–∏–∫ + Country=US| E[üìã SF + QB Invoice –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ]
    D -->|–î—Ä—É–≥–∏–µ| F[üìã –¢–æ–ª—å–∫–æ SF Invoice]
    E --> G[‚è∞ –ê–≤—Ç–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω]
    G --> H[üí∏ –û–ø–ª–∞—Ç–∞ –≤ QB]
    H --> I[üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SF Invoice: Paid]
    I --> J[üéØ Opportunity: Closed Won]
    
    style A fill:#e3f2fd
    style E fill:#e8f5e8
    style I fill:#fff3e0
    style J fill:#f3e5f5
```

## ‚ö° –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—á–∞—Ç—å –†–æ–º–∞–Ω—É

> **–†–æ–º–∞–Ω, –≤—Å–µ –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é! üöÄ**
>
> **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
> - ‚úÖ –£–±—Ä–∞–ª —Ä—É—á–Ω–æ–π —Å—Ç–∞—Ç—É—Å "Approved" - —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
> - ‚úÖ –î–æ–±–∞–≤–∏–ª –ø–æ–ª—è Account.Type –∏ Account.Country__c —á–µ—Ä–µ–∑ metadata
> - ‚úÖ –û–±–Ω–æ–≤–∏–ª –ª–æ–≥–∏–∫—É: —Ç–æ–ª—å–∫–æ US –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ ‚Üí QB
> - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–ø–ª–∞—Ç –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
> - ‚úÖ –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ Opportunity –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
>
> **–ú–æ–∂–µ–º –¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:**
> 1. –Ø –¥–µ–ø–ª–æ—é Salesforce (15 –º–∏–Ω—É—Ç)
> 2. –ö–∞–∫ SSL –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ - –¥–µ–ø–ª–æ–∏–º middleware (10 –º–∏–Ω—É—Ç)  
> 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (15 –º–∏–Ω—É—Ç)
>
> **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—é—Ç –≤—Ä—É—á–Ω—É—é - –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! ‚ú®
>
> **–î–µ–ø–ª–æ–∏—Ç—å —Å–µ–π—á–∞—Å –∏–ª–∏ –∂–¥–µ–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç?**

## üéâ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 100%

**–í—Ä–µ–º—è –¥–æ –∑–∞–ø—É—Å–∫–∞:** 30-40 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

**–í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã, —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã, –º–æ–∂–µ–º –¥–µ–ø–ª–æ–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç!** üöÄ