# Инструкция по тестированию интеграции Salesforce-QuickBooks

## Обновлённый рабочий процесс

На основе ваших комментариев, правильный рабочий процесс следующий:

1. Пользователь создаёт сделку (Opportunity) в Salesforce
2. Пользователь хочет создать счёт в QuickBooks для этой сделки
3. **Важно**: счёт создаётся до смены статуса сделки на "Closed Won"
4. Клиент оплачивает счёт в QuickBooks
5. Система проверяет статус оплаты и только после подтверждения оплаты меняет статус сделки на "Closed Won"

## Тестирование в демо-режиме

В настоящее время система работает в демо-режиме, что позволяет проверить рабочий процесс без реальных API-соединений. Вот как можно протестировать:

### Тест 1: Создание счёта из сделки Salesforce

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "X-API-Key: test_api_key_123" \
  http://localhost:3000/api/create-invoice \
  -d '{
    "opportunityId": "0060800000K95WJAAZ",
    "salesforceInstance": "https://example.salesforce.com",
    "quickbooksRealm": "12345678"
  }'
```

Эта команда симулирует создание счёта в QuickBooks на основе сделки Salesforce с ID `0060800000K95WJAAZ`. В демо-режиме система вернёт данные о созданном счёте и залогирует шаги процесса.

### Тест 2: Проверка статуса оплаты

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "X-API-Key: test_api_key_123" \
  http://localhost:3000/api/check-payment-status \
  -d '{
    "salesforceInstance": "https://example.salesforce.com",
    "quickbooksRealm": "12345678"
  }'
```

Эта команда симулирует проверку статуса оплаты счетов и обновление сделок в Salesforce. В демо-режиме система вернёт информацию о проверенных счетах и о том, какие сделки были обновлены.

### Просмотр логов

```bash
tail -f logs/combined.log
```

Эта команда позволяет в реальном времени наблюдать за логами системы и видеть, что происходит в процессе работы.

## Краткое описание процесса для тестирования

1. Выберите сделку в Salesforce (см. скриншот)
2. Используйте API для создания счёта в QuickBooks из этой сделки
3. Проверьте логи, чтобы убедиться, что счёт был создан успешно
4. Симулируйте оплату счёта в QuickBooks
5. Используйте API для проверки статуса оплаты
6. Проверьте логи, чтобы убедиться, что статус сделки в Salesforce был обновлён на "Closed Won"

## Примечания

- В демо-режиме система не выполняет реальные API-вызовы, а возвращает симулированные данные
- В производственной среде система будет использовать реальные API Salesforce и QuickBooks
- В настоящее время система настроена для ручного создания счетов (что соответствует вашему рабочему процессу)
- Проверка статуса оплаты может быть автоматизирована по расписанию (раз в сутки) или запускаться вручную

## Дальнейшие шаги

После тестирования в демо-режиме следующим шагом будет настройка реальных API-соединений с вашими экземплярами Salesforce и QuickBooks. Это потребует:

1. Настройки OAuth авторизации для обоих сервисов
2. Обновления данных подключения в файле .env
3. Тестирования интеграции с реальными данными
