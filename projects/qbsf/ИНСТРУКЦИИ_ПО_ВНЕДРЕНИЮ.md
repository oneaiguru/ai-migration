# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Salesforce-QuickBooks

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–°—Ç–∞—Ç—É—Å**: 95% –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!  
**–û—Å—Ç–∞–ª–æ—Å—å**: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ  
**–í—Ä–µ–º—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: 1-2 —á–∞—Å–∞ –º–∞–∫—Å–∏–º—É–º  

## üéØ –ß—Ç–æ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
```mermaid
graph LR
    A[API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è] --> B[75% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏]
    B --> C[–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤]
    C --> D[–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ API]
    D --> E[–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É]
    
    style A fill:#90EE90
    style B fill:#90EE90  
    style C fill:#90EE90
    style D fill:#90EE90
    style E fill:#FFE4B5
```

- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - —Å–≤—è–∑—å —Å middleware —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **75% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ** - –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ!  
- ‚úÖ **–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Salesforce —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ LWC –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** - middleware —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```mermaid
graph TB
    SF[Salesforce] --> |HTTP POST| MW[Middleware<br/>sqint.atocomm.eu]
    MW --> |OAuth| QB[QuickBooks Online]
    MW --> |Update| SF
    
    subgraph "Salesforce –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
        OPP[Opportunity] --> TRIGGER[OpportunityQuickBooksTrigger]
        TRIGGER --> QUEUEABLE[QBInvoiceIntegrationQueueable]
        QUEUEABLE --> API[QuickBooksAPIService]
        API --> MW
    end
    
    subgraph "Middleware API"
        MW --> EP1[/api/opportunity-to-invoice]
        MW --> EP2[/api/check-payment-status]
        MW --> EP3[/api/health]
    end
    
    style SF fill:#E1F5FE
    style MW fill:#FFF3E0
    style QB fill:#E8F5E8
```

## üîß –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–¥–ª—è –≤–∞—Å)

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å middleware –∑–¥–æ—Ä–æ–≤—å–µ
```bash
curl -H "X-API-Key: $API_KEY" \
  https://sqint.atocomm.eu/api/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{"success": true, "status": "healthy"}
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Salesforce –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```bash
sf org display -o sanboxsf
```

**–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- Connected Status: ‚úÖ Connected
- Instance Url: https://customer-inspiration-2543--sanboxsf.sandbox.my.salesforce.com

## üöÄ –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å–¥–µ–ª–∫–∏

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant SF as Salesforce
    participant MW as Middleware  
    participant QB as QuickBooks
    
    U->>SF: –°–æ–∑–¥–∞—Ç—å Opportunity
    U->>SF: –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "Proposal and Agreement"
    SF->>MW: HTTP POST /api/opportunity-to-invoice
    MW->>QB: –°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç
    QB-->>MW: Invoice ID
    MW-->>SF: –û–±–Ω–æ–≤–∏—Ç—å Opportunity.QB_Invoice_ID__c
```

### –í Salesforce:
1. **–°–æ–∑–¥–∞—Ç—å Opportunity:**
   - Name: "–¢–µ—Å—Ç–æ–≤—ã–π —Å—á–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
   - Amount: 1000
   - Stage: –ª—é–±–æ–π (–∫—Ä–æ–º–µ "Proposal and Agreement")
   - Close Date: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞

2. **–ò–∑–º–µ–Ω–∏—Ç—å Stage –Ω–∞ "Proposal and Agreement"**
   - –î–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
   - –ü–æ–ª–µ QB_Invoice_ID__c –¥–æ–ª–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å—Å—è

### –ö–æ–º–∞–Ω–¥–∞ —á–µ—Ä–µ–∑ CLI:
```bash
sf data create record -s Opportunity \
  -v "Name='–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏' Amount=1000 StageName='Prospecting' CloseDate=2025-09-01" \
  -o sanboxsf
```

## üîç –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ middleware
tail -f /opt/qb-integration/server.log

# –ò—Å–∫–∞—Ç—å –∑–∞–ø–∏—Å–∏:
# "Creating Invoice in QuickBooks"
# "Invoice created successfully"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Salesforce
1. –û—Ç–∫—Ä—ã—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é Opportunity
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª–µ **QB_Invoice_ID__c** –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª–µ **QB_Last_Sync_Date__c** –æ–±–Ω–æ–≤–ª–µ–Ω–æ

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Route not found"
```mermaid
graph LR
    A[Salesforce –≤—ã–∑—ã–≤–∞–µ—Ç<br/>/api/create-invoice] 
    B[Middleware –æ–∂–∏–¥–∞–µ—Ç<br/>/api/opportunity-to-invoice]
    A -.->|‚ùå –ù–µ–≤–µ—Ä–Ω–æ| B
    C[–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤<br/>QuickBooksAPIService.cls]
    B --> C
    style A fill:#FFCDD2
    style B fill:#C8E6C9
    style C fill:#90EE90
```
**‚úÖ –†–µ—à–µ–Ω–∏–µ: –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ**

### –ü—Ä–æ–±–ª–µ–º–∞: OAuth —Ç–æ–∫–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
**–°–∏–º–ø—Ç–æ–º**: `"tokens is not defined"`  
**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞: 401 Unauthorized  
**–°–∏–º–ø—Ç–æ–º**: Middleware –æ—Ç–≤–µ—á–∞–µ—Ç 401  
**‚úÖ –†–µ—à–µ–Ω–∏–µ: –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∫–ª—é—á

## üè≠ –®–∞–≥ 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —É–±–µ–¥–∏—Ç–µ—Å—å:

```mermaid
graph TD
    A[–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É] --> B{–ï—Å—Ç—å –ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?}
    B -->|–î–∞| C[Salesforce Connected App]
    B -->|–ù–µ—Ç| D[‚ùå –°–¢–û–ü: –ó–∞–ø—Ä–æ—Å–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
    C --> E[QuickBooks Production App]  
    E --> F[SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É]
    F --> G[‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é]
    D --> H[–ü–æ–ª—É—á–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ]
    H --> B
    
    style D fill:#FFCDD2
    style G fill:#90EE90
```

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- [ ] **Salesforce Production org URL** (–Ω–µ sandbox!)
- [ ] **Salesforce Connected App** (Client ID & Secret)
- [ ] **QuickBooks Production App** (Client ID & Secret)  
- [ ] **SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É**: `ssh roman@pve.atocomm.eu -p2323`
- [ ] **–ü–∞—Ä–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞**: `$SSH_PASS` (–∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å?)

### –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh roman@pve.atocomm.eu -p2323

# –û–±–Ω–æ–≤–∏—Ç—å .env
cd /opt/qb-integration
nano .env
```

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–¥–∞–∫—à–µ–Ω .env:**
```bash
# Salesforce (–ü–†–û–î–ê–ö–®–ï–ù - –ù–ï SANDBOX!)
SF_CLIENT_ID=–≤–∞—à_salesforce_client_id
SF_CLIENT_SECRET=–≤–∞—à_salesforce_client_secret  
SF_LOGIN_URL=https://login.salesforce.com
SF_INSTANCE_URL=https://–≤–∞—à–¥–æ–º–µ–Ω.my.salesforce.com

# QuickBooks (–ü–†–û–î–ê–ö–®–ï–ù!)
QB_CLIENT_ID=–≤–∞—à_qb_client_id
QB_CLIENT_SECRET=–≤–∞—à_qb_client_secret
QB_ENVIRONMENT=production

# API –∫–ª—é—á (–ù–ï –ú–ï–ù–Ø–¢–¨!)
API_KEY=$API_KEY
```

## üéØ –®–∞–≥ 5: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Salesforce
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω org
sf org login web --set-default --alias production

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ—Å—Ç–æ–≤
sf project deploy start \
  --source-dir force-app/main/default/classes \
  --source-dir force-app/main/default/triggers \
  --target-org production \
  --test-level RunLocalTests
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ middleware
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
pkill -f node
cd /opt/qb-integration
node src/server.js > server.log 2>&1 &
```

## ‚úÖ –®–∞–≥ 6: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```mermaid
graph LR
    A[–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é Opportunity] --> B[–ò–∑–º–µ–Ω–∏—Ç—å Stage]
    B --> C[–ü—Ä–æ–≤–µ—Ä–∏—Ç—å QB_Invoice_ID__c]
    C --> D[–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ QuickBooks]
    D --> E[‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!]
    
    style E fill:#90EE90
```

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å–¥–µ–ª–∫—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω Salesforce**
2. **–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "Proposal and Agreement"**
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞ –≤ QuickBooks**
4. **–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª–µ QB_Invoice_ID__c –∑–∞–ø–æ–ª–Ω–∏–ª–æ—Å—å**

## üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è —Å–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç –≤ QuickBooks
- [ ] –ü–æ–ª–µ QB_Invoice_ID__c –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö middleware
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end

### üìû –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**: `/opt/qb-integration/server.log`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å health**: `curl https://sqint.atocomm.eu/api/health`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á**: –ù–ï –ú–ï–ù–Ø–¢–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π!

---

## üìà –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**üéØ 95% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ**  
**‚è∞ –û—Å—Ç–∞–ª–æ—Å—å: 1-2 —á–∞—Å–∞ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**  
**üí∞ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º–∫–µ –∏ –æ–ø–ª–∞—Ç–µ**

```mermaid
pie title –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞
    "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" : 95
    "–û—Å—Ç–∞–ª–æ—Å—å" : 5
```

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 22 –∞–≤–≥—É—Å—Ç–∞ 2025*  
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –≤–Ω–µ–¥—Ä–µ–Ω–∏—é*