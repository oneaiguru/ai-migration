# Salesforce-QuickBooks –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø

## ‚úÖ –°–¢–ê–¢–£–°: 100% –†–ê–ë–û–¢–ê–ï–¢
- **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: 24 –∞–≤–≥—É—Å—Ç–∞ 2025
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: QuickBooks —Å—á–µ—Ç–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 
- **–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ**: –°—á–µ—Ç #2047 —Å–æ–∑–¥–∞–Ω –∏–∑ Salesforce opportunity `006So00000R4DbrIAF`

##  –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞ –≤ QuickBooks
```mermaid
graph LR
    A[Salesforce Opportunity] -->|–ú–µ–Ω—è–µ–º —ç—Ç–∞–ø| B["–≠—Ç–∞–ø: Proposal and Agreement"]
    B -->|–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏| C[Trigger —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç]
    C -->|–ß–µ—Ä–µ–∑ 30-60 —Å–µ–∫| D[QuickBooks —Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω]
    D --> E[–ü–æ–ª–µ QB_Invoice_ID__c –∑–∞–ø–æ–ª–Ω–µ–Ω–æ]
```

**–ü–æ—à–∞–≥–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é Opportunity –≤ Salesforce
2. –ò–∑–º–µ–Ω–∏—Ç–µ **Stage** –Ω–∞ **"Proposal and Agreement"**
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30-60 —Å–µ–∫—É–Ω–¥
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ **QB_Invoice_ID__c** - —Ç–∞–º –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
5. –ó–∞–π–¥–∏—Ç–µ –≤ QuickBooks Online ‚Üí Sales ‚Üí Invoices - —Ç–∞–º –±—É–¥–µ—Ç –Ω–æ–≤—ã–π —Å—á–µ—Ç

### 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Opportunity
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞ Opportunity –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- ‚úÖ **Account** (–∫–ª–∏–µ–Ω—Ç)
- ‚úÖ **Products** (—Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏) 
- ‚úÖ **Amount** (—Å—É–º–º–∞)

```mermaid
graph TD
    A[Opportunity] --> B{–ï—Å—Ç—å Account?}
    B -->|–î–∞| C{–ï—Å—Ç—å Products?}
    B -->|–ù–µ—Ç| X[‚ùå –°—á–µ—Ç –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è]
    C -->|–î–∞| D[‚úÖ –°—á–µ—Ç —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤ QB]
    C -->|–ù–µ—Ç| X
```

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
```mermaid
sequenceDiagram
    participant SF as Salesforce
    participant T as Trigger
    participant Q as Queueable
    participant M as Middleware
    participant QB as QuickBooks
    
    SF->>T: Stage = "Proposal and Agreement"
    T->>Q: –ó–∞–ø—É—Å–∫ QBInvoiceIntegrationQueueable
    Q->>M: HTTP –∑–∞–ø—Ä–æ—Å –∫ sqint.atocomm.eu
    M->>QB: –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ QB API
    QB->>M: –í–æ–∑–≤—Ä–∞—Ç –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2047)
    M->>SF: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ QB_Invoice_ID__c
    SF->>SF: ‚úÖ –ì–æ—Ç–æ–≤–æ! –°—á–µ—Ç —Å–æ–∑–¥–∞–Ω
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã (—É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç)

### Custom Settings (–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):
- **QB_Integration_Settings__c**
  - `Middleware_Endpoint__c`: https://sqint.atocomm.eu
  - `API_Key__c`: $API_KEY
  - `QB_Realm_ID__c`: 9130354519120066

### Remote Site Settings (–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):
- **sqint_atocomm_eu**: https://sqint.atocomm.eu

### Deployed Components (—Ä–∞–±–æ—Ç–∞—é—Ç):
- **OpportunityQuickBooksTrigger** - —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∞–ø–∞
- **QBInvoiceIntegrationQueueable** - —Å–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- **QuickBooksInvoiceController** - –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

### –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é Opportunity:
1. **Account**: "test account" (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
2. **Name**: "–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ " + –¥–∞—Ç–∞
3. **Stage**: "Prospecting" 
4. **Amount**: –ª—é–±–∞—è —Å—É–º–º–∞
5. **Products**: –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±–æ–π –ø—Ä–æ–¥—É–∫—Ç
6. –ò–∑–º–µ–Ω–∏—Ç—å **Stage** –Ω–∞ **"Proposal and Agreement"**
7. –ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å **QB_Invoice_ID__c**

```mermaid
flowchart TD
    A[–°–æ–∑–¥–∞—Ç—å Opportunity] --> B[–î–æ–±–∞–≤–∏—Ç—å Products]
    B --> C[Stage = Proposal and Agreement]
    C --> D[–ñ–¥–∞—Ç—å 60 —Å–µ–∫—É–Ω–¥]
    D --> E{QB_Invoice_ID__c –∑–∞–ø–æ–ª–Ω–µ–Ω–æ?}
    E -->|–î–∞| F[‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!]
    E -->|–ù–µ—Ç| G[‚ùå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å server logs]
```

## üéØ –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:
1. **Opportunity**: `006So00000R4DbrIAF` ‚Üí **QB Invoice**: #2047 ‚úÖ
2. **Opportunity**: `006So00000R3LbRIAV` ‚Üí **QB Invoice**: #2045 ‚úÖ

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ QuickBooks:
1. –ó–∞–π—Ç–∏ –≤ https://qbo.intuit.com/app/invoices
2. –ù–∞–π—Ç–∏ —Å—á–µ—Ç–∞ #2045, #2046, #2047
3. –ö–ª–∏–µ–Ω—Ç: "test account" 
4. –°—Ç–∞—Ç—É—Å: Created from Salesforce

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°–µ—Ä–≤–µ—Ä middleware:
- **URL**: https://sqint.atocomm.eu
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
- **SSH**: `ssh roman@pve.atocomm.eu -p2323`
- **–ü–∞—Ä–æ–ª—å**: `$SSH_PASS`

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (–æ–±–Ω–æ–≤–ª–µ–Ω—ã):
- `/opt/qb-integration/src/transforms/opportunity-to-invoice.js` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π ItemRef
- `/opt/qb-integration/src/services/quickbooks-api.js` - –ø–æ–∏—Å–∫ QB —Ç–æ–≤–∞—Ä–æ–≤
- `/opt/qb-integration/src/routes/api.js` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π parsing –æ—Ç–≤–µ—Ç–æ–≤

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
tail -f /opt/qb-integration/server.log
```

## üìù –ü–æ–ª—è Salesforce

### Opportunity Fields (—Ä–∞–±–æ—Ç–∞—é—Ç):
- **QB_Invoice_ID__c** - –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞ QuickBooks (–Ω–∞–ø—Ä–∏–º–µ—Ä: "2047")
- **QB_Payment_Status__c** - —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã  
- **QB_Payment_Amount__c** - —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã
- **QB_Payment_Date__c** - –¥–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã
- **QB_Payment_Method__c** - —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã

```mermaid
graph LR
    A[QB Invoice Created] --> B[QB_Invoice_ID__c = 2047]
    A --> C[QB_Payment_Status__c = Pending]
    A --> D[QB_Payment_Amount__c = null]
    A --> E[QB_Payment_Date__c = null]
```

## ‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Salesforce UI

### –°–ø–æ—Å–æ–± 1: –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é Opportunity
1. –ù–∞–π–¥–∏—Ç–µ –ª—é–±—É—é Opportunity –≤ Salesforce (—á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –∏–ª–∏ —Å–ø–∏—Å–∫–∏)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É Opportunity  
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–±—ã—á–Ω–æ "Edit" –∏–ª–∏ –∫–∞—Ä–∞–Ω–¥–∞—à)
4. –í –ø–æ–ª–µ **Stage** –≤—ã–±–µ—Ä–∏—Ç–µ **"Proposal and Agreement"**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
6. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 60 —Å–µ–∫—É–Ω–¥
7. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É 
8. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ **QB Invoice ID** - —Ç–∞–º –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä

### –°–ø–æ—Å–æ–± 2: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é Opportunity
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Opportunity (–∫–Ω–æ–ø–∫–∞ New/–°–æ–∑–¥–∞—Ç—å)
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
   - **Name**: "–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ [–¥–∞—Ç–∞]"
   - **Account**: –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
   - **Amount**: –ª—é–±–∞—è —Å—É–º–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5000)
   - **Close Date**: –ª—é–±–∞—è –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º
   - **Stage**: **"Proposal and Agreement"** (–≤–∞–∂–Ω–æ!)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
4. –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω Product (—á–µ—Ä–µ–∑ Related Lists)
5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 60 —Å–µ–∫—É–Ω–¥
6. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Opportunity
7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ **QB Invoice ID**

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:
- –ü–æ–ª–µ **QB Invoice ID** –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –Ω–æ–º–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: "2047")
- –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
- –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "QB-PENDING-" - –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å QuickBooks

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ QuickBooks:
1. –í–æ–π–¥–∏—Ç–µ –≤ QuickBooks Online
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª —Å–æ —Å—á–µ—Ç–∞–º–∏/–∏–Ω–≤–æ–π—Å–∞–º–∏  
3. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Å—á–µ—Ç —Å –Ω–æ–º–µ—Ä–æ–º –∏–∑ Salesforce
4. –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Account –∏–∑ Opportunity

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ Developer Console (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```apex
// –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é opportunity
Account testAcc = [SELECT Id FROM Account WHERE Name = 'test account'];
Opportunity testOpp = new Opportunity(
    Name = 'Quick Test ' + System.now(),
    AccountId = testAcc.Id,
    StageName = 'Proposal and Agreement',  // –°—Ä–∞–∑—É –Ω—É–∂–Ω—ã–π —ç—Ç–∞–ø
    Amount = 1000,
    CloseDate = Date.today().addDays(30),
    Pricebook2Id = '01s060000077i0vAAA'
);
insert testOpp;

// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
OpportunityLineItem line = new OpportunityLineItem(
    OpportunityId = testOpp.Id,
    PricebookEntryId = '01u0600000beGIoAAM',
    Quantity = 2,
    UnitPrice = 500
);
insert line;

System.debug('Opportunity created: ' + testOpp.Id);
System.debug('Check QB_Invoice_ID__c in 60 seconds');
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∞–ø–∞ Opportunity –Ω–∞ "Proposal and Agreement":
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—á–µ—Ç –≤ QuickBooks
2. –ü–æ–ª–µ QB_Invoice_ID__c –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–æ–º–µ—Ä–æ–º —Å—á–µ—Ç–∞
3. –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**üèÜ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**